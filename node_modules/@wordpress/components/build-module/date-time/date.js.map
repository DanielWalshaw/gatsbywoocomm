{"version":3,"sources":["@wordpress/components/src/date-time/date.js"],"names":["moment","classnames","DayPickerSingleDateController","Component","createRef","useEffect","useRef","isRTL","_n","sprintf","TIMEZONELESS_FORMAT","ARIAL_LABEL_TIME_FORMAT","DatePickerDay","day","events","ref","current","parentNode","dayAriaLabel","format","length","setAttribute","dayWithEventsDescription","DatePicker","arguments","onChangeMoment","bind","nodeRef","onMonthPreviewedHandler","newMonthDate","props","onMonthPreviewed","toISOString","keepFocusInside","ownerDocument","activeElement","contains","focusRegion","querySelector","focus","newDate","currentDate","onChange","momentDate","momentTime","hours","minutes","seconds","set","filter","eventDay","isSame","date","isInvalidDate","getMomentDate","toDate","getEventsPerDay"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,UAAP,MAAuB,YAAvB,C,CAEA;AACA;;AACA,OAAOC,6BAAP,MAA0C,0DAA1C;AAEA;AACA;AACA;;AACA,SAASC,SAAT,EAAoBC,SAApB,EAA+BC,SAA/B,EAA0CC,MAA1C,QAAwD,oBAAxD;AACA,SAASC,KAAT,EAAgBC,EAAhB,EAAoBC,OAApB,QAAmC,iBAAnC;AAEA;AACA;AACA;;AACA,IAAMC,mBAAmB,GAAG,qBAA5B;AACA,IAAMC,uBAAuB,GAAG,UAAhC;;AAEA,SAASC,aAAT,OAA+C;AAAA,MAArBC,GAAqB,QAArBA,GAAqB;AAAA,yBAAhBC,MAAgB;AAAA,MAAhBA,MAAgB,4BAAP,EAAO;AAC9C,MAAMC,GAAG,GAAGT,MAAM,EAAlB;AAEA;AACD;AACA;AACA;AACA;AACA;;AACCD,EAAAA,SAAS,CAAE,YAAM;AAAA;;AAChB;AACA,QAAK,EAAEU,GAAF,aAAEA,GAAF,+BAAEA,GAAG,CAAEC,OAAP,yCAAE,aAAcC,UAAhB,CAAL,EAAkC;AACjC;AACA;;AAJe,QAMRA,UANQ,GAMOF,GAAG,CAACC,OANX,CAMRC,UANQ;AAOhB,QAAMC,YAAY,GAAGlB,MAAM,CAAEa,GAAF,CAAN,CAAcM,MAAd,CAAsBR,uBAAtB,CAArB;;AAEA,QAAK,CAAEG,MAAM,CAACM,MAAd,EAAuB;AACtB;AACAH,MAAAA,UAAU,CAACI,YAAX,CAAyB,YAAzB,EAAuCH,YAAvC;AACA;AACA;;AAED,QAAMI,wBAAwB,GAAGb,OAAO,EACvC;AACAD,IAAAA,EAAE,CACD,4BADC,EAED,8BAFC,EAGDM,MAAM,CAACM,MAHN,CAFqC,EAOvCF,YAPuC,EAQvCJ,MAAM,CAACM,MARgC,CAAxC;AAWAH,IAAAA,UAAU,CAACI,YAAX,CAAyB,YAAzB,EAAuCC,wBAAvC;AACA,GA3BQ,EA2BN,CAAER,MAAM,CAACM,MAAT,CA3BM,CAAT;AA6BA,SACC;AACC,IAAA,GAAG,EAAGL,GADP;AAEC,IAAA,SAAS,EAAGd,UAAU,CAAE,gCAAF,EAAoC;AACzD,oBAAca,MAAd,aAAcA,MAAd,uBAAcA,MAAM,CAAEM;AADmC,KAApC;AAFvB,KAMGP,GAAG,CAACM,MAAJ,CAAY,GAAZ,CANH,CADD;AAUA;;IAEKI,U;;;;;AACL,wBAAc;AAAA;;AAAA;;AACb,+BAAUC,SAAV;AAEA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBC,IAApB,+BAAtB;AACA,UAAKC,OAAL,GAAevB,SAAS,EAAxB;AACA,UAAKwB,uBAAL,GAA+B,MAAKA,uBAAL,CAA6BF,IAA7B,+BAA/B;AALa;AAQb;;;;WAED,iCAAyBG,YAAzB,EAAwC;AAAA;;AACvC,0BAAKC,KAAL,4DAAYC,gBAAZ,CAA8BF,YAAY,CAACG,WAAb,EAA9B;AACA,WAAKC,eAAL;AACA;AAED;AACD;AACA;AACA;AACA;AACA;;;;WACC,2BAAkB;AACjB,UAAK,CAAE,KAAKN,OAAL,CAAaX,OAApB,EAA8B;AAC7B;AACA;;AAHgB,UAKTkB,aALS,GAKS,KAAKP,OAAL,CAAaX,OALtB,CAKTkB,aALS;AAAA,UAMTC,aANS,GAMSD,aANT,CAMTC,aANS,EAQjB;;AACA,UACC,CAAEA,aAAF,IACA,CAAE,KAAKR,OAAL,CAAaX,OAAb,CAAqBoB,QAArB,CAA+BF,aAAa,CAACC,aAA7C,CAFH,EAGE;AACD;AACA,YAAME,WAAW,GAAG,KAAKV,OAAL,CAAaX,OAAb,CAAqBsB,aAArB,CACnB,wBADmB,CAApB;;AAGA,YAAK,CAAED,WAAP,EAAqB;AACpB;AACA,SAPA,CAQD;;;AACAA,QAAAA,WAAW,CAACE,KAAZ;AACA;AACD;;;WAED,wBAAgBC,OAAhB,EAA0B;AAAA,yBACS,KAAKV,KADd;AAAA,UACjBW,WADiB,gBACjBA,WADiB;AAAA,UACJC,QADI,gBACJA,QADI,EAGzB;;AACA,UAAMC,UAAU,GAAGF,WAAW,GAAGzC,MAAM,CAAEyC,WAAF,CAAT,GAA2BzC,MAAM,EAA/D;AACA,UAAM4C,UAAU,GAAG;AAClBC,QAAAA,KAAK,EAAEF,UAAU,CAACE,KAAX,EADW;AAElBC,QAAAA,OAAO,EAAEH,UAAU,CAACG,OAAX,EAFS;AAGlBC,QAAAA,OAAO,EAAE;AAHS,OAAnB;AAMAL,MAAAA,QAAQ,CAAEF,OAAO,CAACQ,GAAR,CAAaJ,UAAb,EAA0BzB,MAA1B,CAAkCT,mBAAlC,CAAF,CAAR,CAXyB,CAazB;;AACA,WAAKuB,eAAL;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;;;;WACC,uBAAeQ,WAAf,EAA6B;AAC5B,UAAK,SAASA,WAAd,EAA4B;AAC3B,eAAO,IAAP;AACA;;AACD,aAAOA,WAAW,GAAGzC,MAAM,CAAEyC,WAAF,CAAT,GAA2BzC,MAAM,EAAnD;AACA;;;WAED,yBAAiBa,GAAjB,EAAuB;AAAA;;AACtB,UAAK,wBAAE,KAAKiB,KAAL,CAAWhB,MAAb,+CAAE,mBAAmBM,MAArB,CAAL,EAAmC;AAClC,eAAO,EAAP;AACA;;AAED,aAAO,KAAKU,KAAL,CAAWhB,MAAX,CAAkBmC,MAAlB,CAA0B,UAAEC,QAAF;AAAA,eAChCrC,GAAG,CAACsC,MAAJ,CAAYD,QAAQ,CAACE,IAArB,EAA2B,KAA3B,CADgC;AAAA,OAA1B,CAAP;AAGA;;;WAED,kBAAS;AAAA;;AAAA,yBAC+B,KAAKtB,KADpC;AAAA,UACAW,WADA,gBACAA,WADA;AAAA,UACaY,aADb,gBACaA,aADb;AAER,UAAMV,UAAU,GAAG,KAAKW,aAAL,CAAoBb,WAApB,CAAnB;AAEA,aACC;AAAK,QAAA,SAAS,EAAC,2BAAf;AAA2C,QAAA,GAAG,EAAG,KAAKd;AAAtD,SACC,cAAC,6BAAD;AACC,QAAA,IAAI,EAAGgB,UADR;AAEC,QAAA,OAAO,EAAG,EAFX;AAGC,QAAA,OAAO,MAHR;AAIC,QAAA,0BAA0B,MAJ3B,CAKC;AACA;AAND;AAOC,QAAA,GAAG,kCACFA,UAAU,GAAGA,UAAU,CAACxB,MAAX,CAAmB,SAAnB,CAAH,GAAoC,MAD5C,CAPJ;AAUC,QAAA,QAAQ,MAVT;AAWC,QAAA,cAAc,EAAG,CAXlB;AAYC,QAAA,YAAY,EAAG,KAAKM,cAZrB;AAaC,QAAA,kBAAkB,EAAG,CAbtB;AAcC,QAAA,aAAa,EAAC,KAdf;AAeC,QAAA,kBAAkB,EAAGd,uBAftB;AAgBC,QAAA,KAAK,EAAGJ,KAAK,EAhBd;AAiBC,QAAA,cAAc,EAAG,wBAAE6C,IAAF,EAAY;AAC5B,iBAAOC,aAAa,IAAIA,aAAa,CAAED,IAAI,CAACG,MAAL,EAAF,CAArC;AACA,SAnBF;AAoBC,QAAA,gBAAgB,EAAG,KAAK3B,uBApBzB;AAqBC,QAAA,gBAAgB,EAAG,KAAKA,uBArBzB;AAsBC,QAAA,iBAAiB,EAAG,2BAAEf,GAAF;AAAA,iBACnB,cAAC,aAAD;AACC,YAAA,GAAG,EAAGA,GADP;AAEC,YAAA,MAAM,EAAG,MAAI,CAAC2C,eAAL,CAAsB3C,GAAtB;AAFV,YADmB;AAAA;AAtBrB,QADD,CADD;AAiCA;;;;EA7HuBV,S;;AAgIzB,eAAeoB,UAAf","sourcesContent":["/**\n * External dependencies\n */\nimport moment from 'moment';\nimport classnames from 'classnames';\n\n// react-dates doesn't tree-shake correctly, so we import from the individual\n// component here, to avoid including too much of the library\nimport DayPickerSingleDateController from 'react-dates/lib/components/DayPickerSingleDateController';\n\n/**\n * WordPress dependencies\n */\nimport { Component, createRef, useEffect, useRef } from '@wordpress/element';\nimport { isRTL, _n, sprintf } from '@wordpress/i18n';\n\n/**\n * Module Constants\n */\nconst TIMEZONELESS_FORMAT = 'YYYY-MM-DDTHH:mm:ss';\nconst ARIAL_LABEL_TIME_FORMAT = 'dddd, LL';\n\nfunction DatePickerDay( { day, events = [] } ) {\n\tconst ref = useRef();\n\n\t/*\n\t * a11y hack to make the `There is/are n events` string\n\t * available speaking for readers,\n\t * re-defining the aria-label attribute.\n\t * This attribute is handled by the react-dates component.\n\t */\n\tuseEffect( () => {\n\t\t// Bail when no parent node.\n\t\tif ( ! ref?.current?.parentNode ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { parentNode } = ref.current;\n\t\tconst dayAriaLabel = moment( day ).format( ARIAL_LABEL_TIME_FORMAT );\n\n\t\tif ( ! events.length ) {\n\t\t\t// Set aria-label without event description.\n\t\t\tparentNode.setAttribute( 'aria-label', dayAriaLabel );\n\t\t\treturn;\n\t\t}\n\n\t\tconst dayWithEventsDescription = sprintf(\n\t\t\t// translators: 1: Calendar day format, 2: Calendar event number.\n\t\t\t_n(\n\t\t\t\t'%1$s. There is %2$d event.',\n\t\t\t\t'%1$s. There are %2$d events.',\n\t\t\t\tevents.length\n\t\t\t),\n\t\t\tdayAriaLabel,\n\t\t\tevents.length\n\t\t);\n\n\t\tparentNode.setAttribute( 'aria-label', dayWithEventsDescription );\n\t}, [ events.length ] );\n\n\treturn (\n\t\t<div\n\t\t\tref={ ref }\n\t\t\tclassName={ classnames( 'components-datetime__date__day', {\n\t\t\t\t'has-events': events?.length,\n\t\t\t} ) }\n\t\t>\n\t\t\t{ day.format( 'D' ) }\n\t\t</div>\n\t);\n}\n\nclass DatePicker extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChangeMoment = this.onChangeMoment.bind( this );\n\t\tthis.nodeRef = createRef();\n\t\tthis.onMonthPreviewedHandler = this.onMonthPreviewedHandler.bind(\n\t\t\tthis\n\t\t);\n\t}\n\n\tonMonthPreviewedHandler( newMonthDate ) {\n\t\tthis.props?.onMonthPreviewed( newMonthDate.toISOString() );\n\t\tthis.keepFocusInside();\n\t}\n\n\t/*\n\t * Todo: We should remove this function ASAP.\n\t * It is kept because focus is lost when we click on the previous and next month buttons.\n\t * This focus loss closes the date picker popover.\n\t * Ideally we should add an upstream commit on react-dates to fix this issue.\n\t */\n\tkeepFocusInside() {\n\t\tif ( ! this.nodeRef.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { ownerDocument } = this.nodeRef.current;\n\t\tconst { activeElement } = ownerDocument;\n\n\t\t// If focus was lost.\n\t\tif (\n\t\t\t! activeElement ||\n\t\t\t! this.nodeRef.current.contains( ownerDocument.activeElement )\n\t\t) {\n\t\t\t// Retrieve the focus region div.\n\t\t\tconst focusRegion = this.nodeRef.current.querySelector(\n\t\t\t\t'.DayPicker_focusRegion'\n\t\t\t);\n\t\t\tif ( ! focusRegion ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Keep the focus on focus region.\n\t\t\tfocusRegion.focus();\n\t\t}\n\t}\n\n\tonChangeMoment( newDate ) {\n\t\tconst { currentDate, onChange } = this.props;\n\n\t\t// If currentDate is null, use now as momentTime to designate hours, minutes, seconds.\n\t\tconst momentDate = currentDate ? moment( currentDate ) : moment();\n\t\tconst momentTime = {\n\t\t\thours: momentDate.hours(),\n\t\t\tminutes: momentDate.minutes(),\n\t\t\tseconds: 0,\n\t\t};\n\n\t\tonChange( newDate.set( momentTime ).format( TIMEZONELESS_FORMAT ) );\n\n\t\t// Keep focus on the date picker.\n\t\tthis.keepFocusInside();\n\t}\n\n\t/**\n\t * Create a Moment object from a date string. With no currentDate supplied, default to a Moment\n\t * object representing now. If a null value is passed, return a null value.\n\t *\n\t * @param {?string} currentDate Date representing the currently selected date or null to signify no selection.\n\t * @return {?moment.Moment} Moment object for selected date or null.\n\t */\n\tgetMomentDate( currentDate ) {\n\t\tif ( null === currentDate ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn currentDate ? moment( currentDate ) : moment();\n\t}\n\n\tgetEventsPerDay( day ) {\n\t\tif ( ! this.props.events?.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn this.props.events.filter( ( eventDay ) =>\n\t\t\tday.isSame( eventDay.date, 'day' )\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { currentDate, isInvalidDate } = this.props;\n\t\tconst momentDate = this.getMomentDate( currentDate );\n\n\t\treturn (\n\t\t\t<div className=\"components-datetime__date\" ref={ this.nodeRef }>\n\t\t\t\t<DayPickerSingleDateController\n\t\t\t\t\tdate={ momentDate }\n\t\t\t\t\tdaySize={ 30 }\n\t\t\t\t\tfocused\n\t\t\t\t\thideKeyboardShortcutsPanel\n\t\t\t\t\t// This is a hack to force the calendar to update on month or year change\n\t\t\t\t\t// https://github.com/airbnb/react-dates/issues/240#issuecomment-361776665\n\t\t\t\t\tkey={ `datepicker-controller-${\n\t\t\t\t\t\tmomentDate ? momentDate.format( 'MM-YYYY' ) : 'null'\n\t\t\t\t\t}` }\n\t\t\t\t\tnoBorder\n\t\t\t\t\tnumberOfMonths={ 1 }\n\t\t\t\t\tonDateChange={ this.onChangeMoment }\n\t\t\t\t\ttransitionDuration={ 0 }\n\t\t\t\t\tweekDayFormat=\"ddd\"\n\t\t\t\t\tdayAriaLabelFormat={ ARIAL_LABEL_TIME_FORMAT }\n\t\t\t\t\tisRTL={ isRTL() }\n\t\t\t\t\tisOutsideRange={ ( date ) => {\n\t\t\t\t\t\treturn isInvalidDate && isInvalidDate( date.toDate() );\n\t\t\t\t\t} }\n\t\t\t\t\tonPrevMonthClick={ this.onMonthPreviewedHandler }\n\t\t\t\t\tonNextMonthClick={ this.onMonthPreviewedHandler }\n\t\t\t\t\trenderDayContents={ ( day ) => (\n\t\t\t\t\t\t<DatePickerDay\n\t\t\t\t\t\t\tday={ day }\n\t\t\t\t\t\t\tevents={ this.getEventsPerDay( day ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default DatePicker;\n"]}