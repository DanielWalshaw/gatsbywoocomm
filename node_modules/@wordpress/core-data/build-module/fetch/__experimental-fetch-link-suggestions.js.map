{"version":3,"sources":["@wordpress/core-data/src/fetch/__experimental-fetch-link-suggestions.js"],"names":["apiFetch","addQueryArgs","decodeEntities","__","fetchLinkSuggestions","search","searchOptions","settings","isInitialSuggestions","type","undefined","subtype","page","perPage","disablePostFormats","queries","push","path","per_page","then","results","map","result","meta","kind","catch","Promise","all","reduce","accumulator","current","concat","filter","id","slice","url","title"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Filters the search by type\n *\n * @typedef { 'post' | 'term' | 'post-format' } WPLinkSearchType\n */\n\n/**\n * A link with an id may be of kind post-type or taxonomy\n *\n * @typedef { 'post-type' | 'taxonomy' } WPKind\n */\n\n/**\n * @typedef WPLinkSearchOptions\n *\n * @property {boolean}             [isInitialSuggestions] Displays initial search suggestions, when true.\n * @property {WPLinkSearchType}    [type]                 Filters by search type.\n * @property {string}              [subtype]              Slug of the post-type or taxonomy.\n * @property {number}              [page]                 Which page of results to return.\n * @property {number}              [perPage]              Search results per page.\n */\n\n/**\n * @typedef WPLinkSearchResult\n *\n * @property {number} id     Post or term id.\n * @property {string} url    Link url.\n * @property {string} title  Title of the link.\n * @property {string} type   The taxonomy or post type slug or type URL.\n * @property {WPKind} [kind] Link kind of post-type or taxonomy\n */\n\n/**\n * @typedef WPEditorSettings\n *\n * @property {boolean} [ disablePostFormats ] Disables post formats, when true.\n */\n\n/**\n * Fetches link suggestions from the API.\n *\n * @async\n * @param {string}              search\n * @param {WPLinkSearchOptions} [searchOptions]\n * @param {WPEditorSettings}    [settings]\n *\n * @example\n * ```js\n * import { __experimentalFetchLinkSuggestions as fetchLinkSuggestions } from '@wordpress/core-data';\n *\n * //...\n *\n * export function initialize( id, settings ) {\n *\n * settings.__experimentalFetchLinkSuggestions = (\n *     search,\n *     searchOptions\n * ) => fetchLinkSuggestions( search, searchOptions, settings );\n * ```\n * @return {Promise< WPLinkSearchResult[] >} List of search suggestions\n */\nconst fetchLinkSuggestions = async (\n\tsearch,\n\tsearchOptions = {},\n\tsettings = {}\n) => {\n\tconst {\n\t\tisInitialSuggestions = false,\n\t\ttype = undefined,\n\t\tsubtype = undefined,\n\t\tpage = undefined,\n\t\tperPage = isInitialSuggestions ? 3 : 20,\n\t} = searchOptions;\n\n\tconst { disablePostFormats = false } = settings;\n\n\tconst queries = [];\n\n\tif ( ! type || type === 'post' ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'post',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} )\n\t\t\t\t.then( ( results ) => {\n\t\t\t\t\treturn results.map( ( result ) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...result,\n\t\t\t\t\t\t\tmeta: { kind: 'post-type', subtype },\n\t\t\t\t\t\t};\n\t\t\t\t\t} );\n\t\t\t\t} )\n\t\t\t\t.catch( () => [] ) // fail by returning no results\n\t\t);\n\t}\n\n\tif ( ! type || type === 'term' ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'term',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} )\n\t\t\t\t.then( ( results ) => {\n\t\t\t\t\treturn results.map( ( result ) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...result,\n\t\t\t\t\t\t\tmeta: { kind: 'taxonomy', subtype },\n\t\t\t\t\t\t};\n\t\t\t\t\t} );\n\t\t\t\t} )\n\t\t\t\t.catch( () => [] )\n\t\t);\n\t}\n\n\tif ( ! disablePostFormats && ( ! type || type === 'post-format' ) ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'post-format',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} ).catch( () => [] )\n\t\t);\n\t}\n\n\treturn Promise.all( queries ).then( ( results ) => {\n\t\treturn results\n\t\t\t.reduce(\n\t\t\t\t( accumulator, current ) => accumulator.concat( current ), //flatten list\n\t\t\t\t[]\n\t\t\t)\n\t\t\t.filter(\n\t\t\t\t/**\n\t\t\t\t * @param {{ id: number }} result\n\t\t\t\t */\n\t\t\t\t( result ) => {\n\t\t\t\t\treturn !! result.id;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.slice( 0, perPage )\n\t\t\t.map(\n\t\t\t\t/**\n\t\t\t\t * @param {{ id: number, url:string, title?:string, subtype?: string, type?: string }} result\n\t\t\t\t */\n\t\t\t\t( result ) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: result.id,\n\t\t\t\t\t\turl: result.url,\n\t\t\t\t\t\ttitle:\n\t\t\t\t\t\t\tdecodeEntities( result.title || '' ) ||\n\t\t\t\t\t\t\t__( '(no title)' ),\n\t\t\t\t\t\ttype: result.subtype || result.type,\n\t\t\t\t\t\tkind: result?.meta?.kind,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t);\n\t} );\n};\n\nexport default fetchLinkSuggestions;\n"]}