{"version":3,"sources":["@wordpress/editor/src/components/post-schedule/index.js"],"names":["__experimentalGetSettings","useDispatch","useSelect","DateTimePicker","useRef","useState","useMemo","store","coreStore","editorStore","getDayOfTheMonth","date","Date","firstDay","d","getFullYear","getMonth","toISOString","PostSchedule","select","postDate","getEditedPostAttribute","postType","getCurrentPostType","editPost","onUpdateDate","previewedMonth","setPreviewedMonth","eventsByPostType","getEntityRecords","status","after","before","exclude","getCurrentPostId","events","map","title","type","eventDate","rendered","ref","settings","is12HourTime","test","formats","time","toLowerCase","replace","split","reverse","join","onChange","newDate","ownerDocument","current","activeElement","blur"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __experimentalGetSettings } from '@wordpress/date';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { DateTimePicker } from '@wordpress/components';\nimport { useRef, useState, useMemo } from '@wordpress/element';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { store as editorStore } from '../../store';\n\nfunction getDayOfTheMonth( date = new Date(), firstDay = true ) {\n\tconst d = new Date( date );\n\treturn new Date(\n\t\td.getFullYear(),\n\t\td.getMonth() + ( firstDay ? 0 : 1 ),\n\t\tfirstDay ? 1 : 0\n\t).toISOString();\n}\n\nexport default function PostSchedule() {\n\tconst { postDate, postType } = useSelect(\n\t\t( select ) => ( {\n\t\t\tpostDate: select( editorStore ).getEditedPostAttribute( 'date' ),\n\t\t\tpostType: select( editorStore ).getCurrentPostType(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tconst { editPost } = useDispatch( editorStore );\n\tconst onUpdateDate = ( date ) => editPost( { date } );\n\n\tconst [ previewedMonth, setPreviewedMonth ] = useState(\n\t\tgetDayOfTheMonth( postDate )\n\t);\n\n\t// Pick up published and schduled site posts.\n\tconst eventsByPostType = useSelect(\n\t\t( select ) =>\n\t\t\tselect( coreStore ).getEntityRecords( 'postType', postType, {\n\t\t\t\tstatus: 'publish,future',\n\t\t\t\tafter: getDayOfTheMonth( previewedMonth ),\n\t\t\t\tbefore: getDayOfTheMonth( previewedMonth, false ),\n\t\t\t\texclude: [ select( editorStore ).getCurrentPostId() ],\n\t\t\t} ),\n\t\t[ previewedMonth, postType ]\n\t);\n\n\tconst events = useMemo(\n\t\t() =>\n\t\t\t( eventsByPostType || [] ).map(\n\t\t\t\t( { title, type, date: eventDate } ) => ( {\n\t\t\t\t\ttitle: title?.rendered,\n\t\t\t\t\ttype,\n\t\t\t\t\tdate: new Date( eventDate ),\n\t\t\t\t} )\n\t\t\t),\n\t\t[ eventsByPostType ]\n\t);\n\n\tconst ref = useRef();\n\tconst settings = __experimentalGetSettings();\n\n\t// To know if the current timezone is a 12 hour time with look for \"a\" in the time format\n\t// We also make sure this a is not escaped by a \"/\"\n\tconst is12HourTime = /a(?!\\\\)/i.test(\n\t\tsettings.formats.time\n\t\t\t.toLowerCase() // Test only the lower case a\n\t\t\t.replace( /\\\\\\\\/g, '' ) // Replace \"//\" with empty strings\n\t\t\t.split( '' )\n\t\t\t.reverse()\n\t\t\t.join( '' ) // Reverse the string and test for \"a\" not followed by a slash\n\t);\n\n\tfunction onChange( newDate ) {\n\t\tonUpdateDate( newDate );\n\t\tconst { ownerDocument } = ref.current;\n\t\townerDocument.activeElement.blur();\n\t}\n\n\treturn (\n\t\t<DateTimePicker\n\t\t\tref={ ref }\n\t\t\tcurrentDate={ postDate }\n\t\t\tonChange={ onChange }\n\t\t\tis12Hour={ is12HourTime }\n\t\t\tevents={ events }\n\t\t\tonMonthPreviewed={ setPreviewedMonth }\n\t\t/>\n\t);\n}\n"]}