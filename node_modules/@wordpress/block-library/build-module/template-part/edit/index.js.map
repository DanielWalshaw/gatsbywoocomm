{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/index.js"],"names":["useSelect","BlockControls","useBlockProps","__experimentalUseNoRecursiveRenders","useNoRecursiveRenders","Warning","store","blockEditorStore","Dropdown","ToolbarGroup","ToolbarButton","Spinner","__","sprintf","coreStore","TemplatePartInnerBlocks","TemplatePartPlaceholder","TemplatePartSelection","TemplatePartAdvancedControls","getTagBasedOnArea","TemplatePartEdit","attributes","setAttributes","clientId","slug","theme","tagName","layout","templatePartId","hasAlreadyRendered","RecursionProvider","select","getEditedEntityRecord","hasFinishedResolution","getBlocks","getEntityArgs","entityRecord","hasResolvedEntity","innerBlocks","isResolved","isMissing","area","blockProps","isPlaceholder","isEntityAvailable","TagName","length","isOpen","onToggle","onClose"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport {\n\tBlockControls,\n\tuseBlockProps,\n\t__experimentalUseNoRecursiveRenders as useNoRecursiveRenders,\n\tWarning,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport {\n\tDropdown,\n\tToolbarGroup,\n\tToolbarButton,\n\tSpinner,\n} from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport TemplatePartInnerBlocks from './inner-blocks';\nimport TemplatePartPlaceholder from './placeholder';\nimport TemplatePartSelection from './selection';\nimport { TemplatePartAdvancedControls } from './advanced-controls';\nimport { getTagBasedOnArea } from './get-tag-based-on-area';\n\nexport default function TemplatePartEdit( {\n\tattributes,\n\tsetAttributes,\n\tclientId,\n} ) {\n\tconst { slug, theme, tagName, layout = {} } = attributes;\n\tconst templatePartId = theme && slug ? theme + '//' + slug : null;\n\n\tconst [ hasAlreadyRendered, RecursionProvider ] = useNoRecursiveRenders(\n\t\ttemplatePartId\n\t);\n\n\t// Set the postId block attribute if it did not exist,\n\t// but wait until the inner blocks have loaded to allow\n\t// new edits to trigger this.\n\tconst { isResolved, innerBlocks, isMissing, area } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEditedEntityRecord, hasFinishedResolution } = select(\n\t\t\t\tcoreStore\n\t\t\t);\n\t\t\tconst { getBlocks } = select( blockEditorStore );\n\n\t\t\tconst getEntityArgs = [\n\t\t\t\t'postType',\n\t\t\t\t'wp_template_part',\n\t\t\t\ttemplatePartId,\n\t\t\t];\n\t\t\tconst entityRecord = templatePartId\n\t\t\t\t? getEditedEntityRecord( ...getEntityArgs )\n\t\t\t\t: null;\n\t\t\tconst hasResolvedEntity = templatePartId\n\t\t\t\t? hasFinishedResolution(\n\t\t\t\t\t\t'getEditedEntityRecord',\n\t\t\t\t\t\tgetEntityArgs\n\t\t\t\t  )\n\t\t\t\t: false;\n\n\t\t\treturn {\n\t\t\t\tinnerBlocks: getBlocks( clientId ),\n\t\t\t\tisResolved: hasResolvedEntity,\n\t\t\t\tisMissing: hasResolvedEntity && ! entityRecord,\n\t\t\t\tarea: entityRecord?.area,\n\t\t\t};\n\t\t},\n\t\t[ templatePartId, clientId ]\n\t);\n\n\tconst blockProps = useBlockProps();\n\tconst isPlaceholder = ! slug;\n\tconst isEntityAvailable = ! isPlaceholder && ! isMissing && isResolved;\n\tconst TagName = tagName || getTagBasedOnArea( area );\n\n\t// We don't want to render a missing state if we have any inner blocks.\n\t// A new template part is automatically created if we have any inner blocks but no entity.\n\tif (\n\t\tinnerBlocks.length === 0 &&\n\t\t( ( slug && ! theme ) || ( slug && isMissing ) )\n\t) {\n\t\treturn (\n\t\t\t<TagName { ...blockProps }>\n\t\t\t\t<Warning>\n\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t/* translators: %s: Template part slug */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Template part has been deleted or is unavailable: %s'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tslug\n\t\t\t\t\t) }\n\t\t\t\t</Warning>\n\t\t\t</TagName>\n\t\t);\n\t}\n\n\tif ( isEntityAvailable && hasAlreadyRendered ) {\n\t\treturn (\n\t\t\t<TagName { ...blockProps }>\n\t\t\t\t<Warning>\n\t\t\t\t\t{ __( 'Block cannot be rendered inside itself.' ) }\n\t\t\t\t</Warning>\n\t\t\t</TagName>\n\t\t);\n\t}\n\n\treturn (\n\t\t<RecursionProvider>\n\t\t\t<TemplatePartAdvancedControls\n\t\t\t\ttagName={ tagName }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\tisEntityAvailable={ isEntityAvailable }\n\t\t\t\ttemplatePartId={ templatePartId }\n\t\t\t/>\n\t\t\t{ isPlaceholder && (\n\t\t\t\t<TagName { ...blockProps }>\n\t\t\t\t\t<TemplatePartPlaceholder\n\t\t\t\t\t\tarea={ attributes.area }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\tinnerBlocks={ innerBlocks }\n\t\t\t\t\t/>\n\t\t\t\t</TagName>\n\t\t\t) }\n\t\t\t{ isEntityAvailable && (\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<ToolbarGroup className=\"wp-block-template-part__block-control-group\">\n\t\t\t\t\t\t<Dropdown\n\t\t\t\t\t\t\tclassName=\"wp-block-template-part__preview-dropdown-button\"\n\t\t\t\t\t\t\tcontentClassName=\"wp-block-template-part__preview-dropdown-content\"\n\t\t\t\t\t\t\tposition=\"bottom right left\"\n\t\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\t\t\t\t// Disable when open to prevent odd FireFox bug causing reopening.\n\t\t\t\t\t\t\t\t\t// As noted in https://github.com/WordPress/gutenberg/pull/24990#issuecomment-689094119 .\n\t\t\t\t\t\t\t\t\tdisabled={ isOpen }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Replace' ) }\n\t\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t\t\t\t\t<TemplatePartSelection\n\t\t\t\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ToolbarGroup>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ isEntityAvailable && (\n\t\t\t\t<TemplatePartInnerBlocks\n\t\t\t\t\ttagName={ TagName }\n\t\t\t\t\tblockProps={ blockProps }\n\t\t\t\t\tpostId={ templatePartId }\n\t\t\t\t\thasInnerBlocks={ innerBlocks.length > 0 }\n\t\t\t\t\tlayout={ layout }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ ! isPlaceholder && ! isResolved && (\n\t\t\t\t<TagName { ...blockProps }>\n\t\t\t\t\t<Spinner />\n\t\t\t\t</TagName>\n\t\t\t) }\n\t\t</RecursionProvider>\n\t);\n}\n"]}