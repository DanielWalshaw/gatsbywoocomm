{"version":3,"sources":["@wordpress/block-library/src/legacy-widget/edit/index.js"],"names":["useBlockProps","BlockControls","InspectorControls","BlockIcon","store","blockEditorStore","ToolbarGroup","ToolbarButton","Spinner","Placeholder","brush","brushIcon","update","updateIcon","__","useState","useCallback","useSelect","coreStore","WidgetTypeSelector","InspectorCard","FormWrapper","Form","Preview","Edit","props","attributes","id","idBase","Empty","setAttributes","selectedId","isMulti","instance","NotEmpty","select","widgetTypeId","hiddenIds","getSettings","widgetTypesToHideFromLegacyWidgetBlock","widgetType","getWidgetType","hasResolved","hasFinishedResolution","isWidgetTypeHidden","includes","tab","setTab","setInstance","newInstance","name","description"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tuseBlockProps,\n\tBlockControls,\n\tInspectorControls,\n\tBlockIcon,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport {\n\tToolbarGroup,\n\tToolbarButton,\n\tSpinner,\n\tPlaceholder,\n} from '@wordpress/components';\nimport { brush as brushIcon, update as updateIcon } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useState, useCallback } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport WidgetTypeSelector from './widget-type-selector';\nimport InspectorCard from './inspector-card';\nimport FormWrapper from './form-wrapper';\nimport Form from './form';\nimport Preview from './preview';\n\nexport default function Edit( props ) {\n\tconst { id, idBase } = props.attributes;\n\treturn (\n\t\t<div { ...useBlockProps() }>\n\t\t\t{ ! id && ! idBase ? (\n\t\t\t\t<Empty { ...props } />\n\t\t\t) : (\n\t\t\t\t<NotEmpty { ...props } />\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nfunction Empty( { attributes: { id, idBase }, setAttributes } ) {\n\treturn (\n\t\t<Placeholder\n\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t>\n\t\t\t<WidgetTypeSelector\n\t\t\t\tselectedId={ id ?? idBase }\n\t\t\t\tonSelect={ ( { selectedId, isMulti } ) => {\n\t\t\t\t\tif ( ! selectedId ) {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else if ( isMulti ) {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\tidBase: selectedId,\n\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: selectedId,\n\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t/>\n\t\t</Placeholder>\n\t);\n}\n\nfunction NotEmpty( { attributes: { id, idBase, instance }, setAttributes } ) {\n\tconst { widgetType, hasResolved, isWidgetTypeHidden } = useSelect(\n\t\t( select ) => {\n\t\t\tconst widgetTypeId = id ?? idBase;\n\t\t\tconst hiddenIds =\n\t\t\t\tselect( blockEditorStore ).getSettings()\n\t\t\t\t\t?.widgetTypesToHideFromLegacyWidgetBlock ?? [];\n\t\t\treturn {\n\t\t\t\twidgetType: select( coreStore ).getWidgetType( widgetTypeId ),\n\t\t\t\thasResolved: select(\n\t\t\t\t\tcoreStore\n\t\t\t\t).hasFinishedResolution( 'getWidgetType', [ widgetTypeId ] ),\n\t\t\t\tisWidgetTypeHidden: hiddenIds.includes( widgetTypeId ),\n\t\t\t};\n\t\t},\n\t\t[ id, idBase ]\n\t);\n\n\tconst [ tab, setTab ] = useState( 'edit' );\n\n\tconst setInstance = useCallback(\n\t\t( newInstance ) => setAttributes( { instance: newInstance } ),\n\t\t[ setAttributes ]\n\t);\n\n\tif ( ! widgetType && ! hasResolved ) {\n\t\treturn <Spinner />;\n\t}\n\n\tif ( ! widgetType && hasResolved ) {\n\t\treturn <Placeholder>{ __( 'Widget is missing.' ) }</Placeholder>;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t{ ! isWidgetTypeHidden && (\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\tlabel={ __( 'Change widget' ) }\n\t\t\t\t\t\t\ticon={ updateIcon }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ idBase && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\tisPressed={ tab === 'edit' }\n\t\t\t\t\t\t\t\tonClick={ () => setTab( 'edit' ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{ __( 'Edit' ) }</span>\n\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\tisPressed={ tab === 'preview' }\n\t\t\t\t\t\t\t\tonClick={ () => setTab( 'preview' ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{ __( 'Preview' ) }</span>\n\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\n\t\t\t<InspectorControls>\n\t\t\t\t<InspectorCard\n\t\t\t\t\tname={ widgetType.name }\n\t\t\t\t\tdescription={ widgetType.description }\n\t\t\t\t/>\n\t\t\t</InspectorControls>\n\n\t\t\t<FormWrapper title={ widgetType.name } isVisible={ tab === 'edit' }>\n\t\t\t\t<Form\n\t\t\t\t\tid={ id }\n\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\tinstance={ instance }\n\t\t\t\t\tsetInstance={ setInstance }\n\t\t\t\t/>\n\t\t\t</FormWrapper>\n\n\t\t\t{ idBase && (\n\t\t\t\t<Preview\n\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\tinstance={ instance }\n\t\t\t\t\tisVisible={ tab === 'preview' }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"]}