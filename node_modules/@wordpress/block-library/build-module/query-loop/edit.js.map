{"version":3,"sources":["@wordpress/block-library/src/query-loop/edit.js"],"names":["classnames","useState","useMemo","useSelect","__","BlockContextProvider","BlockPreview","useBlockProps","__experimentalUseInnerBlocksProps","useInnerBlocksProps","store","blockEditorStore","coreStore","TEMPLATE","QueryLoopEdit","clientId","context","query","perPage","offset","categoryIds","postType","tagIds","order","orderBy","author","search","exclude","sticky","inherit","queryContext","page","templateSlug","layout","type","layoutType","columns","activeBlockContext","setActiveBlockContext","select","getEntityRecords","getBlocks","categories","tags","orderby","per_page","length","startsWith","replace","posts","blocks","blockContexts","map","post","postId","id","hasLayoutFlex","blockProps","className","innerBlocksProps","template","blockContext"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tBlockContextProvider,\n\tBlockPreview,\n\tuseBlockProps,\n\t__experimentalUseInnerBlocksProps as useInnerBlocksProps,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\n\nconst TEMPLATE = [\n\t[ 'core/post-title' ],\n\t[ 'core/post-date' ],\n\t[ 'core/post-excerpt' ],\n];\nexport default function QueryLoopEdit( {\n\tclientId,\n\tcontext: {\n\t\tquery: {\n\t\t\tperPage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\tpostType,\n\t\t\ttagIds = [],\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t\texclude,\n\t\t\tsticky,\n\t\t\tinherit,\n\t\t} = {},\n\t\tqueryContext = [ { page: 1 } ],\n\t\ttemplateSlug,\n\t\tlayout: { type: layoutType = 'flex', columns = 1 } = {},\n\t},\n} ) {\n\tconst [ { page } ] = queryContext;\n\tconst [ activeBlockContext, setActiveBlockContext ] = useState();\n\n\tconst { posts, blocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecords } = select( coreStore );\n\t\t\tconst { getBlocks } = select( blockEditorStore );\n\t\t\tconst query = {\n\t\t\t\toffset: perPage ? perPage * ( page - 1 ) + offset : 0,\n\t\t\t\tcategories: categoryIds,\n\t\t\t\ttags: tagIds,\n\t\t\t\torder,\n\t\t\t\torderby: orderBy,\n\t\t\t};\n\t\t\tif ( perPage ) {\n\t\t\t\tquery.per_page = perPage;\n\t\t\t}\n\t\t\tif ( author ) {\n\t\t\t\tquery.author = author;\n\t\t\t}\n\t\t\tif ( search ) {\n\t\t\t\tquery.search = search;\n\t\t\t}\n\t\t\tif ( exclude?.length ) {\n\t\t\t\tquery.exclude = exclude;\n\t\t\t}\n\t\t\t// If sticky is not set, it will return all posts in the results.\n\t\t\t// If sticky is set to `only`, it will limit the results to sticky posts only.\n\t\t\t// If it is anything else, it will exclude sticky posts from results. For the record the value stored is `exclude`.\n\t\t\tif ( sticky ) {\n\t\t\t\tquery.sticky = sticky === 'only';\n\t\t\t}\n\t\t\t// If `inherit` is truthy, adjust conditionally the query to create a better preview.\n\t\t\tif ( inherit ) {\n\t\t\t\t// Change the post-type if needed.\n\t\t\t\tif ( templateSlug?.startsWith( 'archive-' ) ) {\n\t\t\t\t\tquery.postType = templateSlug.replace( 'archive-', '' );\n\t\t\t\t\tpostType = query.postType;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tposts: getEntityRecords( 'postType', postType, query ),\n\t\t\t\tblocks: getBlocks( clientId ),\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tperPage,\n\t\t\tpage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\ttagIds,\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tclientId,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t\tpostType,\n\t\t\texclude,\n\t\t\tsticky,\n\t\t\tinherit,\n\t\t\ttemplateSlug,\n\t\t]\n\t);\n\n\tconst blockContexts = useMemo(\n\t\t() =>\n\t\t\tposts?.map( ( post ) => ( {\n\t\t\t\tpostType: post.type,\n\t\t\t\tpostId: post.id,\n\t\t\t} ) ),\n\t\t[ posts ]\n\t);\n\tconst hasLayoutFlex = layoutType === 'flex' && columns > 1;\n\tconst blockProps = useBlockProps( {\n\t\tclassName: classnames( {\n\t\t\t'is-flex-container': hasLayoutFlex,\n\t\t\t[ `columns-${ columns }` ]: hasLayoutFlex,\n\t\t} ),\n\t} );\n\tconst innerBlocksProps = useInnerBlocksProps( {}, { template: TEMPLATE } );\n\n\tif ( ! posts ) {\n\t\treturn <p { ...blockProps }>{ __( 'Loadingâ€¦' ) }</p>;\n\t}\n\n\tif ( ! posts.length ) {\n\t\treturn <p { ...blockProps }> { __( 'No results found.' ) }</p>;\n\t}\n\n\treturn (\n\t\t<ul { ...blockProps }>\n\t\t\t{ blockContexts &&\n\t\t\t\tblockContexts.map( ( blockContext ) => (\n\t\t\t\t\t<BlockContextProvider\n\t\t\t\t\t\tkey={ blockContext.postId }\n\t\t\t\t\t\tvalue={ blockContext }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ blockContext ===\n\t\t\t\t\t\t( activeBlockContext || blockContexts[ 0 ] ) ? (\n\t\t\t\t\t\t\t<li { ...innerBlocksProps } />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<BlockPreview\n\t\t\t\t\t\t\t\t\tblocks={ blocks }\n\t\t\t\t\t\t\t\t\t__experimentalLive\n\t\t\t\t\t\t\t\t\t__experimentalOnClick={ () =>\n\t\t\t\t\t\t\t\t\t\tsetActiveBlockContext( blockContext )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</BlockContextProvider>\n\t\t\t\t) ) }\n\t\t</ul>\n\t);\n}\n"]}