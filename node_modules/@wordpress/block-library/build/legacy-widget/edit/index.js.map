{"version":3,"sources":["@wordpress/block-library/src/legacy-widget/edit/index.js"],"names":["Edit","props","attributes","id","idBase","Empty","setAttributes","brushIcon","selectedId","isMulti","instance","NotEmpty","select","widgetTypeId","hiddenIds","blockEditorStore","getSettings","widgetTypesToHideFromLegacyWidgetBlock","widgetType","coreStore","getWidgetType","hasResolved","hasFinishedResolution","isWidgetTypeHidden","includes","tab","setTab","setInstance","newInstance","updateIcon","name","description"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tuseBlockProps,\n\tBlockControls,\n\tInspectorControls,\n\tBlockIcon,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport {\n\tToolbarGroup,\n\tToolbarButton,\n\tSpinner,\n\tPlaceholder,\n} from '@wordpress/components';\nimport { brush as brushIcon, update as updateIcon } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useState, useCallback } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport WidgetTypeSelector from './widget-type-selector';\nimport InspectorCard from './inspector-card';\nimport FormWrapper from './form-wrapper';\nimport Form from './form';\nimport Preview from './preview';\n\nexport default function Edit( props ) {\n\tconst { id, idBase } = props.attributes;\n\treturn (\n\t\t<div { ...useBlockProps() }>\n\t\t\t{ ! id && ! idBase ? (\n\t\t\t\t<Empty { ...props } />\n\t\t\t) : (\n\t\t\t\t<NotEmpty { ...props } />\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nfunction Empty( { attributes: { id, idBase }, setAttributes } ) {\n\treturn (\n\t\t<Placeholder\n\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t>\n\t\t\t<WidgetTypeSelector\n\t\t\t\tselectedId={ id ?? idBase }\n\t\t\t\tonSelect={ ( { selectedId, isMulti } ) => {\n\t\t\t\t\tif ( ! selectedId ) {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else if ( isMulti ) {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\tidBase: selectedId,\n\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: selectedId,\n\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t/>\n\t\t</Placeholder>\n\t);\n}\n\nfunction NotEmpty( { attributes: { id, idBase, instance }, setAttributes } ) {\n\tconst { widgetType, hasResolved, isWidgetTypeHidden } = useSelect(\n\t\t( select ) => {\n\t\t\tconst widgetTypeId = id ?? idBase;\n\t\t\tconst hiddenIds =\n\t\t\t\tselect( blockEditorStore ).getSettings()\n\t\t\t\t\t?.widgetTypesToHideFromLegacyWidgetBlock ?? [];\n\t\t\treturn {\n\t\t\t\twidgetType: select( coreStore ).getWidgetType( widgetTypeId ),\n\t\t\t\thasResolved: select(\n\t\t\t\t\tcoreStore\n\t\t\t\t).hasFinishedResolution( 'getWidgetType', [ widgetTypeId ] ),\n\t\t\t\tisWidgetTypeHidden: hiddenIds.includes( widgetTypeId ),\n\t\t\t};\n\t\t},\n\t\t[ id, idBase ]\n\t);\n\n\tconst [ tab, setTab ] = useState( 'edit' );\n\n\tconst setInstance = useCallback(\n\t\t( newInstance ) => setAttributes( { instance: newInstance } ),\n\t\t[ setAttributes ]\n\t);\n\n\tif ( ! widgetType && ! hasResolved ) {\n\t\treturn <Spinner />;\n\t}\n\n\tif ( ! widgetType && hasResolved ) {\n\t\treturn <Placeholder>{ __( 'Widget is missing.' ) }</Placeholder>;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t{ ! isWidgetTypeHidden && (\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\tlabel={ __( 'Change widget' ) }\n\t\t\t\t\t\t\ticon={ updateIcon }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ idBase && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\tisPressed={ tab === 'edit' }\n\t\t\t\t\t\t\t\tonClick={ () => setTab( 'edit' ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{ __( 'Edit' ) }</span>\n\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\tisPressed={ tab === 'preview' }\n\t\t\t\t\t\t\t\tonClick={ () => setTab( 'preview' ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{ __( 'Preview' ) }</span>\n\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\n\t\t\t<InspectorControls>\n\t\t\t\t<InspectorCard\n\t\t\t\t\tname={ widgetType.name }\n\t\t\t\t\tdescription={ widgetType.description }\n\t\t\t\t/>\n\t\t\t</InspectorControls>\n\n\t\t\t<FormWrapper title={ widgetType.name } isVisible={ tab === 'edit' }>\n\t\t\t\t<Form\n\t\t\t\t\tid={ id }\n\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\tinstance={ instance }\n\t\t\t\t\tsetInstance={ setInstance }\n\t\t\t\t/>\n\t\t\t</FormWrapper>\n\n\t\t\t{ idBase && (\n\t\t\t\t<Preview\n\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\tinstance={ instance }\n\t\t\t\t\tisVisible={ tab === 'preview' }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"]}