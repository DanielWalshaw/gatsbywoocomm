{"version":3,"sources":["@wordpress/block-library/src/query/edit/query-block-setup.js"],"names":["QueryBlockSetup","clientId","query","attributes","setAttributes","blockName","name","postType","inherit","blockEditorStore","replaceBlocks","replaceInnerBlocks","postTypesSelectOptions","updateQuery","newQuery","onVariationSelect","nextVariation","innerBlocks","onBlockPatternSelect","blocks","clonedBlocks","map","block","clone","queryAttributes","Object","assign","perPage","inheritToggleHelp","value","newValue"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { cloneDeep } from 'lodash';\n/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { __, _x } from '@wordpress/i18n';\nimport { SelectControl, ToggleControl } from '@wordpress/components';\nimport {\n\tcloneBlock,\n\tcreateBlocksFromInnerBlocksTemplate,\n} from '@wordpress/blocks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport BlockSetup from './block-setup';\nimport { usePostTypes } from '../utils';\n\nconst QueryBlockSetup = ( {\n\tclientId,\n\tattributes: { query },\n\tsetAttributes,\n\tname: blockName,\n} ) => {\n\tconst { postType, inherit } = query;\n\tconst { replaceBlocks, replaceInnerBlocks } = useDispatch(\n\t\tblockEditorStore\n\t);\n\tconst { postTypesSelectOptions } = usePostTypes();\n\tconst updateQuery = ( newQuery ) =>\n\t\tsetAttributes( { query: { ...query, ...newQuery } } );\n\tconst onVariationSelect = ( nextVariation ) => {\n\t\tif ( nextVariation.attributes ) {\n\t\t\tsetAttributes( nextVariation.attributes );\n\t\t}\n\t\tif ( nextVariation.innerBlocks ) {\n\t\t\treplaceInnerBlocks(\n\t\t\t\tclientId,\n\t\t\t\tcreateBlocksFromInnerBlocksTemplate(\n\t\t\t\t\tnextVariation.innerBlocks\n\t\t\t\t),\n\t\t\t\tfalse\n\t\t\t);\n\t\t}\n\t};\n\tconst onBlockPatternSelect = ( blocks ) => {\n\t\tconst clonedBlocks = blocks.map( ( block ) => {\n\t\t\tconst clone = cloneBlock( block );\n\t\t\t/**\n\t\t\t * TODO: this check will be revised with the ongoing work on block patterns.\n\t\t\t * For now we keep the value of posts per page (`query.perPage`) from Query patterns\n\t\t\t * so as to preview the pattern as intended, without possible big previews.\n\t\t\t * During insertion, we need to override the Query's attributes that can be set in\n\t\t\t * the Placeholder and we unset the `perPage` value to be set appropriately by Query block.\n\t\t\t */\n\t\t\tif ( block.name === 'core/query' ) {\n\t\t\t\t/**\n\t\t\t\t * We need to `cloneDeep` the Query's attributes, as `cloneBlock` does a swallow\n\t\t\t\t * copy of the block.\n\t\t\t\t */\n\t\t\t\tconst queryAttributes = cloneDeep( clone.attributes );\n\t\t\t\tObject.assign( queryAttributes.query, {\n\t\t\t\t\tinherit: query.inherit,\n\t\t\t\t\tpostType: query.postType,\n\t\t\t\t\tperPage: null,\n\t\t\t\t} );\n\t\t\t\treturn {\n\t\t\t\t\t...clone,\n\t\t\t\t\tattributes: queryAttributes,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn clone;\n\t\t} );\n\t\treplaceBlocks( clientId, clonedBlocks );\n\t};\n\tconst inheritToggleHelp = !! inherit\n\t\t? _x(\n\t\t\t\t'Inherit the global query depending on the URL.',\n\t\t\t\t'Query block `inherit` option helping text'\n\t\t  )\n\t\t: _x(\n\t\t\t\t'Customize the query arguments.',\n\t\t\t\t'Query block `inherit` option helping text'\n\t\t  );\n\treturn (\n\t\t<BlockSetup\n\t\t\tblockName={ blockName }\n\t\t\tuseLayoutSetup={ true }\n\t\t\tonVariationSelect={ onVariationSelect }\n\t\t\tonBlockPatternSelect={ onBlockPatternSelect }\n\t\t>\n\t\t\t<div className=\"block-attributes-setup-container\">\n\t\t\t\t<ToggleControl\n\t\t\t\t\tlabel={ __( 'Inherit query from URL' ) }\n\t\t\t\t\tchecked={ !! inherit }\n\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\tupdateQuery( { inherit: !! value } )\n\t\t\t\t\t}\n\t\t\t\t\thelp={ inheritToggleHelp }\n\t\t\t\t/>\n\t\t\t\t{ ! inherit && (\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\toptions={ postTypesSelectOptions }\n\t\t\t\t\t\tvalue={ postType }\n\t\t\t\t\t\tlabel={ __( 'Post Type' ) }\n\t\t\t\t\t\tonChange={ ( newValue ) =>\n\t\t\t\t\t\t\tupdateQuery( { postType: newValue } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</BlockSetup>\n\t);\n};\n\nexport default QueryBlockSetup;\n"]}