{"version":3,"sources":["@wordpress/block-library/src/page-list/convert-to-links-modal.js"],"names":["PAGE_FIELDS","MAX_PAGE_COUNT","convertSelectedBlockToNavigationLinks","pages","clientId","replaceBlock","createBlock","linkMap","navigationLinks","forEach","id","title","url","link","type","parent","innerBlocks","label","rendered","kind","push","parentLinkInnerBlocks","ConvertToLinksModal","onClose","select","coreDataStore","getEntityRecords","hasFinishedResolution","query","per_page","_fields","orderby","order","pagesFinished","blockEditorStore","describedby","create"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Button, Modal } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as coreDataStore } from '@wordpress/core-data';\nimport { createBlock as create } from '@wordpress/blocks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\nconst PAGE_FIELDS = [ 'id', 'title', 'link', 'type', 'parent' ];\nconst MAX_PAGE_COUNT = 100;\n\nexport const convertSelectedBlockToNavigationLinks = ( {\n\tpages,\n\tclientId,\n\treplaceBlock,\n\tcreateBlock,\n} ) => () => {\n\tif ( ! pages ) {\n\t\treturn;\n\t}\n\n\tconst linkMap = {};\n\tconst navigationLinks = [];\n\tpages.forEach( ( { id, title, link: url, type, parent } ) => {\n\t\t// See if a placeholder exists. This is created if children appear before parents in list\n\t\tconst innerBlocks = linkMap[ id ]?.innerBlocks ?? [];\n\t\tlinkMap[ id ] = createBlock(\n\t\t\t'core/navigation-link',\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\tlabel: title.rendered,\n\t\t\t\turl,\n\t\t\t\ttype,\n\t\t\t\tkind: 'post-type',\n\t\t\t},\n\t\t\tinnerBlocks\n\t\t);\n\n\t\tif ( ! parent ) {\n\t\t\tnavigationLinks.push( linkMap[ id ] );\n\t\t} else {\n\t\t\tif ( ! linkMap[ parent ] ) {\n\t\t\t\t// Use a placeholder if the child appears before parent in list\n\t\t\t\tlinkMap[ parent ] = { innerBlocks: [] };\n\t\t\t}\n\t\t\tconst parentLinkInnerBlocks = linkMap[ parent ].innerBlocks;\n\t\t\tparentLinkInnerBlocks.push( linkMap[ id ] );\n\t\t}\n\t} );\n\n\treplaceBlock( clientId, navigationLinks );\n};\n\nexport default function ConvertToLinksModal( { onClose, clientId } ) {\n\tconst { pages, pagesFinished } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecords, hasFinishedResolution } = select(\n\t\t\t\tcoreDataStore\n\t\t\t);\n\t\t\tconst query = [\n\t\t\t\t'postType',\n\t\t\t\t'page',\n\t\t\t\t{\n\t\t\t\t\tper_page: MAX_PAGE_COUNT,\n\t\t\t\t\t_fields: PAGE_FIELDS,\n\t\t\t\t\t// TODO: When https://core.trac.wordpress.org/ticket/39037 REST API support for multiple orderby\n\t\t\t\t\t// values is resolved, update 'orderby' to [ 'menu_order', 'post_title' ] to provide a consistent\n\t\t\t\t\t// sort.\n\t\t\t\t\torderby: 'menu_order',\n\t\t\t\t\torder: 'asc',\n\t\t\t\t},\n\t\t\t];\n\t\t\treturn {\n\t\t\t\tpages: getEntityRecords( ...query ),\n\t\t\t\tpagesFinished: hasFinishedResolution(\n\t\t\t\t\t'getEntityRecords',\n\t\t\t\t\tquery\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\n\n\treturn (\n\t\t<Modal\n\t\t\tcloseLabel={ __( 'Close' ) }\n\t\t\tonRequestClose={ onClose }\n\t\t\ttitle={ __( 'Convert to links' ) }\n\t\t\tclassName={ 'wp-block-page-list-modal' }\n\t\t\taria={ { describedby: 'wp-block-page-list-modal__description' } }\n\t\t>\n\t\t\t<p id={ 'wp-block-page-list-modal__description' }>\n\t\t\t\t{ __(\n\t\t\t\t\t'To edit this navigation menu, convert it to single page links. This allows you to add, re-order, remove items, or edit their labels.'\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t{ __(\n\t\t\t\t\t\"Note: if you add new pages to your site, you'll need to add them to your navigation menu.\"\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<div className=\"wp-block-page-list-modal-buttons\">\n\t\t\t\t<Button isTertiary onClick={ onClose }>\n\t\t\t\t\t{ __( 'Cancel' ) }\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tisPrimary\n\t\t\t\t\tdisabled={ ! pagesFinished }\n\t\t\t\t\tonClick={ convertSelectedBlockToNavigationLinks( {\n\t\t\t\t\t\tpages,\n\t\t\t\t\t\treplaceBlock,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tcreateBlock: create,\n\t\t\t\t\t} ) }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Convert' ) }\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</Modal>\n\t);\n}\n"]}