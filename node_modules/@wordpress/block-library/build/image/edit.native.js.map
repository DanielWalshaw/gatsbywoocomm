{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["getUrlForSlug","image","sizeSlug","ImageEdit","props","state","isCaptionSelected","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetLinkDestination","onSetNewTab","onSetSizeSlug","onImagePressed","onFocusCaption","updateAlignment","accessibilityLabelCreator","setMappedAttributes","onSizeChangeValue","linkSettingsOptions","url","label","placeholder","autoFocus","autoFill","openInNewTab","linkRel","sizeOptions","imageSizes","name","slug","value","attributes","setAttributes","id","console","warn","isUploadInProgress","previousProps","source_url","caption","setState","payload","mediaUrl","mediaServerId","mediaId","width","undefined","height","nextAlign","extraUpdatedAttributes","Object","values","WIDE_ALIGNMENTS","alignments","includes","align","href","linkDestination","LINK_DESTINATION_CUSTOM","updatedLinkTarget","media","imageDefaultSize","mediaAttributes","additionalAttributes","onFocus","placeholderIcon","getStylesFromColorScheme","styles","iconPlaceholder","iconPlaceholderDark","restAttributes","isLinkSheetVisible","unMappedAttributes","mappedAttributes","rel","linkTarget","dismissSheet","alt","updateAlt","newAlt","textColor","newValue","isSelected","clientId","featuredImageId","wasBlockJustInserted","className","sizeOptionsValid","isFeaturedImage","getToolbarEditButton","open","replace","getInspectorControls","panelBody","expand","getAltTextSettings","getLinkSettings","content","MEDIA_TYPE_IMAGE","getPlaceholderIcon","alignToFlex","left","center","right","full","wide","getImageComponent","openMediaOptions","getMediaOptions","isUploadFailed","retryMessage","getWidth","onBlur","insertBlocksAfter","Component","select","coreStore","getMedia","blockEditorStore","getSettings","getEditedPostAttribute","isNotFileUrl","shouldGetMedia","withPreferredColorScheme"],"mappings":";;;;;;;;;AASA;;;;;;;;;;;;;;;;;;;;AANA;;AACA;;AAMA;;AAOA;;AAaA;;AAYA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAMA;;AAKA;;AACA;;AAEA;;;;;;;;;;AAEA,IAAMA,aAAa,GAAG,SAAhBA,aAAgB,CAAEC,KAAF,QAA2B;AAAA,MAAhBC,QAAgB,QAAhBA,QAAgB;AAChD,SAAO,iBAAKD,KAAL,EAAY,CAAE,eAAF,EAAmB,OAAnB,EAA4BC,QAA5B,EAAsC,YAAtC,CAAZ,CAAP;AACA,CAFD;;IAIaC,S;;;;;AACZ,qBAAaC,KAAb,EAAqB;AAAA;;AAAA;AACpB,8BAAOA,KAAP;AAEA,UAAKC,KAAL,GAAa;AACZC,MAAAA,iBAAiB,EAAE;AADP,KAAb;AAIA,UAAKC,4BAAL,GAAoC,MAAKA,4BAAL,CAAkCC,IAAlC,6CAApC;AAGA,UAAKC,4BAAL,GAAoC,MAAKA,4BAAL,CAAkCD,IAAlC,6CAApC;AAGA,UAAKE,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BF,IAA3B,6CAA7B;AACA,UAAKG,yBAAL,GAAiC,MAAKA,yBAAL,CAA+BH,IAA/B,6CAAjC;AAGA,UAAKI,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBJ,IAAzB,6CAA3B;AACA,UAAKK,cAAL,GAAsB,MAAKA,cAAL,CAAoBL,IAApB,6CAAtB;AACA,UAAKM,oBAAL,GAA4B,MAAKA,oBAAL,CAA0BN,IAA1B,6CAA5B;AACA,UAAKO,WAAL,GAAmB,MAAKA,WAAL,CAAiBP,IAAjB,6CAAnB;AACA,UAAKQ,aAAL,GAAqB,MAAKA,aAAL,CAAmBR,IAAnB,6CAArB;AACA,UAAKS,cAAL,GAAsB,MAAKA,cAAL,CAAoBT,IAApB,6CAAtB;AACA,UAAKU,cAAL,GAAsB,MAAKA,cAAL,CAAoBV,IAApB,6CAAtB;AACA,UAAKW,eAAL,GAAuB,MAAKA,eAAL,CAAqBX,IAArB,6CAAvB;AACA,UAAKY,yBAAL,GAAiC,MAAKA,yBAAL,CAA+BZ,IAA/B,6CAAjC;AAGA,UAAKa,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBb,IAAzB,6CAA3B;AACA,UAAKc,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBd,IAAvB,6CAAzB;AAEA,UAAKe,mBAAL,GAA2B;AAC1BC,MAAAA,GAAG,EAAE;AACJC,QAAAA,KAAK,EAAE,cAAI,gBAAJ,CADH;AAEJC,QAAAA,WAAW,EAAE,cAAI,SAAJ,CAFT;AAGJC,QAAAA,SAAS,EAAE,KAHP;AAIJC,QAAAA,QAAQ,EAAE;AAJN,OADqB;AAO1BC,MAAAA,YAAY,EAAE;AACbJ,QAAAA,KAAK,EAAE,cAAI,iBAAJ;AADM,OAPY;AAU1BK,MAAAA,OAAO,EAAE;AACRL,QAAAA,KAAK,EAAE,cAAI,UAAJ,CADC;AAERC,QAAAA,WAAW,EAAE,cAAI,MAAJ;AAFL;AAViB,KAA3B;AAgBA,UAAKK,WAAL,GAAmB,iBAAK,MAAK3B,KAAL,CAAW4B,UAAhB,EAA4B;AAAA,UAAIC,IAAJ,SAAIA,IAAJ;AAAA,UAAUC,IAAV,SAAUA,IAAV;AAAA,aAAwB;AACtEC,QAAAA,KAAK,EAAED,IAD+D;AAEtED,QAAAA,IAAI,EAAJA;AAFsE,OAAxB;AAAA,KAA5B,CAAnB;AA/CoB;AAmDpB;;;;WAED,6BAAoB;AAAA,wBACmB,KAAK7B,KADxB;AAAA,UACXgC,UADW,eACXA,UADW;AAAA,UACCC,aADD,eACCA,aADD,EAEnB;AACA;AACA;;AACA,UAAKD,UAAU,CAACE,EAAX,IAAiB,CAAEF,UAAU,CAACZ,GAAnC,EAAyC;AACxC;AACAe,QAAAA,OAAO,CAACC,IAAR,CAAc,gCAAd;AACA,OARkB,CAUnB;;;AACA,UACC,CAAEJ,UAAU,CAACE,EAAb,IACAF,UAAU,CAACZ,GADX,IAEA,sBAAaY,UAAU,CAACZ,GAAxB,MAAkC,OAHnC,EAIE;AACD,mDAAoBY,UAAU,CAACZ,GAA/B,EAAoC,UAAEc,EAAF,EAAMd,GAAN,EAAe;AAClD,cAAKA,GAAL,EAAW;AACVa,YAAAA,aAAa,CAAE;AAAEC,cAAAA,EAAE,EAAFA,EAAF;AAAMd,cAAAA,GAAG,EAAHA;AAAN,aAAF,CAAb;AACA;AACD,SAJD;AAKA,OArBkB,CAuBnB;AACA;;;AACA,UACCY,UAAU,CAACE,EAAX,IACAF,UAAU,CAACZ,GADX,IAEA,sBAAaY,UAAU,CAACZ,GAAxB,MAAkC,OAHnC,EAIE;AACD;AACA;AACD;;;WAED,gCAAuB;AACtB;AACA,UACC,sBAAW,iCAAX,KACA,KAAKnB,KAAL,CAAWoC,kBAFZ,EAGE;AACD,6BACC,iCADD,EAEC,KAAKrC,KAAL,CAAWgC,UAAX,CAAsBE,EAFvB;AAIA;AACD;;;WAED,4BAAoBI,aAApB,EAAoC;AACnC,UAAK,CAAEA,aAAa,CAACzC,KAAhB,IAAyB,KAAKG,KAAL,CAAWH,KAAzC,EAAiD;AAAA,2BAClB,KAAKG,KADa;AAAA,YACxCH,KADwC,gBACxCA,KADwC;AAAA,YACjCmC,UADiC,gBACjCA,UADiC;AAEhD,YAAMZ,GAAG,GAAGxB,aAAa,CAAEC,KAAF,EAASmC,UAAT,CAAb,IAAsCnC,KAAK,CAAC0C,UAAxD;AACA,aAAKvC,KAAL,CAAWiC,aAAX,CAA0B;AAAEb,UAAAA,GAAG,EAAHA;AAAF,SAA1B;AACA;AACD;;;WAUD,mCAA2BoB,OAA3B,EAAqC;AACpC,aAAO,qBAASA,OAAT;AACJ;AACA,4BAFI,GAGJ;AACA;AACA,oBAAI,mBAAJ,CAFA,EAGAA,OAHA,CAHH;AAQA;;;WAED,0BAAiB;AAAA,yBACc,KAAKxC,KADnB;AAAA,UACRgC,UADQ,gBACRA,UADQ;AAAA,UACInC,KADJ,gBACIA,KADJ;;AAGhB,UAAK,KAAKI,KAAL,CAAWoC,kBAAhB,EAAqC;AACpC,+DAAgCL,UAAU,CAACE,EAA3C;AACA,OAFD,MAEO,IACNF,UAAU,CAACE,EAAX,IACA,sBAAaF,UAAU,CAACZ,GAAxB,MAAkC,OAF5B,EAGL;AACD,8DAA+BY,UAAU,CAACE,EAA1C;AACA,OALM,MAKA,IAAK,CAAE,KAAKjC,KAAL,CAAWC,iBAAlB,EAAsC;AAC5C,8DACC8B,UAAU,CAACZ,GADZ,EAECvB,KAAK,IAAIA,KAAK,CAAC0C,UAFhB;AAIA;;AAED,WAAKE,QAAL,CAAe;AACdvC,QAAAA,iBAAiB,EAAE;AADL,OAAf;AAGA;;;WAED,6BAAqBwC,OAArB,EAA+B;AAAA,UACtBT,aADsB,GACJ,KAAKjC,KADD,CACtBiC,aADsB;;AAE9B,UAAKS,OAAO,CAACC,QAAb,EAAwB;AACvBV,QAAAA,aAAa,CAAE;AAAEb,UAAAA,GAAG,EAAEsB,OAAO,CAACC;AAAf,SAAF,CAAb;AACA;;AAED,UAAK,CAAE,KAAK1C,KAAL,CAAWoC,kBAAlB,EAAuC;AACtC,aAAKI,QAAL,CAAe;AAAEJ,UAAAA,kBAAkB,EAAE;AAAtB,SAAf;AACA;AACD;;;WAED,sCAA8BK,OAA9B,EAAwC;AAAA,UAC/BT,aAD+B,GACb,KAAKjC,KADQ,CAC/BiC,aAD+B;AAGvCA,MAAAA,aAAa,CAAE;AAAEb,QAAAA,GAAG,EAAEsB,OAAO,CAACC,QAAf;AAAyBT,QAAAA,EAAE,EAAEQ,OAAO,CAACE;AAArC,OAAF,CAAb;AACA,WAAKH,QAAL,CAAe;AAAEJ,QAAAA,kBAAkB,EAAE;AAAtB,OAAf;AACA;;;WAED,sCAA8BK,OAA9B,EAAwC;AAAA,UAC/BT,aAD+B,GACb,KAAKjC,KADQ,CAC/BiC,aAD+B;AAGvCA,MAAAA,aAAa,CAAE;AAAEC,QAAAA,EAAE,EAAEQ,OAAO,CAACG;AAAd,OAAF,CAAb;AACA,WAAKJ,QAAL,CAAe;AAAEJ,QAAAA,kBAAkB,EAAE;AAAtB,OAAf;AACA;;;WAED,iCAAwB;AAAA,UACfJ,aADe,GACG,KAAKjC,KADR,CACfiC,aADe;AAGvBA,MAAAA,aAAa,CAAE;AAAEC,QAAAA,EAAE,EAAE,IAAN;AAAYd,QAAAA,GAAG,EAAE;AAAjB,OAAF,CAAb;AACA,WAAKqB,QAAL,CAAe;AAAEJ,QAAAA,kBAAkB,EAAE;AAAtB,OAAf;AACA;;;WAED,wBAAgBjB,GAAhB,EAAsB;AACrB,WAAKpB,KAAL,CAAWiC,aAAX,CAA0B;AACzBb,QAAAA,GAAG,EAAHA,GADyB;AAEzB0B,QAAAA,KAAK,EAAEC,SAFkB;AAGzBC,QAAAA,MAAM,EAAED;AAHiB,OAA1B;AAKA;;;WAED,yBAAiBE,SAAjB,EAA6B;AAC5B,UAAMC,sBAAsB,GAAGC,MAAM,CAACC,MAAP,CAC9BC,4BAAgBC,UADc,EAE7BC,QAF6B,CAEnBN,SAFmB,IAG5B;AAAEH,QAAAA,KAAK,EAAEC,SAAT;AAAoBC,QAAAA,MAAM,EAAED;AAA5B,OAH4B,GAI5B,EAJH;AAKA,WAAK/C,KAAL,CAAWiC,aAAX,iCACIiB,sBADJ;AAECM,QAAAA,KAAK,EAAEP;AAFR;AAIA;;;WAED,8BAAsBQ,IAAtB,EAA6B;AAC5B,WAAKzD,KAAL,CAAWiC,aAAX,CAA0B;AACzByB,QAAAA,eAAe,EAAEC,kCADQ;AAEzBF,QAAAA,IAAI,EAAJA;AAFyB,OAA1B;AAIA;;;WAED,qBAAa1B,KAAb,EAAqB;AACpB,UAAM6B,iBAAiB,GAAG,yCACzB7B,KADyB,EAEzB,KAAK/B,KAAL,CAAWgC,UAFc,CAA1B;AAIA,WAAKhC,KAAL,CAAWiC,aAAX,CAA0B2B,iBAA1B;AACA;;;WAED,uBAAe9D,QAAf,EAA0B;AAAA,UACjBD,KADiB,GACP,KAAKG,KADE,CACjBH,KADiB;AAGzB,UAAMuB,GAAG,GAAGxB,aAAa,CAAEC,KAAF,EAAS;AAAEC,QAAAA,QAAQ,EAARA;AAAF,OAAT,CAAzB;;AACA,UAAK,CAAEsB,GAAP,EAAa;AACZ,eAAO,IAAP;AACA;;AAED,WAAKpB,KAAL,CAAWiC,aAAX,CAA0B;AACzBb,QAAAA,GAAG,EAAHA,GADyB;AAEzB0B,QAAAA,KAAK,EAAEC,SAFkB;AAGzBC,QAAAA,MAAM,EAAED,SAHiB;AAIzBjD,QAAAA,QAAQ,EAARA;AAJyB,OAA1B;AAMA;;;WAED,mCAA2B+D,KAA3B,EAAmC;AAAA,yBAI9B,KAAK7D,KAJyB;AAAA,+CAEjCgC,UAFiC;AAAA,UAEnBE,EAFmB,yBAEnBA,EAFmB;AAAA,UAEfd,GAFe,yBAEfA,GAFe;AAAA,UAGjC0C,gBAHiC,gBAGjCA,gBAHiC;AAMlC,UAAMC,eAAe,GAAG;AACvB7B,QAAAA,EAAE,EAAE2B,KAAK,CAAC3B,EADa;AAEvBd,QAAAA,GAAG,EAAEyC,KAAK,CAACzC,GAFY;AAGvBoB,QAAAA,OAAO,EAAEqB,KAAK,CAACrB;AAHQ,OAAxB;AAMA,UAAIwB,oBAAJ,CAZkC,CAalC;;AACA,UAAK,CAAEH,KAAK,CAAC3B,EAAR,IAAc2B,KAAK,CAAC3B,EAAN,KAAaA,EAAhC,EAAqC;AACpC8B,QAAAA,oBAAoB,GAAG;AACtBlB,UAAAA,KAAK,EAAEC,SADe;AAEtBC,UAAAA,MAAM,EAAED,SAFc;AAGtBjD,UAAAA,QAAQ,EAAEgE;AAHY,SAAvB;AAKA,OAND,MAMO;AACN;AACAE,QAAAA,oBAAoB,GAAG;AAAE5C,UAAAA,GAAG,EAAHA;AAAF,SAAvB;AACA;;AAED,WAAKpB,KAAL,CAAWiC,aAAX,iCACI8B,eADJ,GAEIC,oBAFJ;AAIA;;;WAED,0BAAiB;AAChB,UAAK,KAAKhE,KAAL,CAAWiE,OAAhB,EAA0B;AACzB,aAAKjE,KAAL,CAAWiE,OAAX;AACA;;AACD,UAAK,CAAE,KAAKhE,KAAL,CAAWC,iBAAlB,EAAsC;AACrC,aAAKuC,QAAL,CAAe;AACdvC,UAAAA,iBAAiB,EAAE;AADL,SAAf;AAGA;AACD;;;WAED,8BAAqB;AACpB,aACC,4BAAC,gBAAD;AACC,QAAA,IAAI,EAAGgE;AADR,SAEM,KAAKlE,KAAL,CAAWmE,wBAAX,CACJC,gBAAOC,eADH,EAEJD,gBAAOE,mBAFH,CAFN,EADD;AASA;;;WAED,oBAAW;AAAA,UACFtC,UADE,GACa,KAAKhC,KADlB,CACFgC,UADE;AAAA,UAEFwB,KAFE,GAEexB,UAFf,CAEFwB,KAFE;AAAA,UAEKV,KAFL,GAEed,UAFf,CAEKc,KAFL;AAIV,aAAOK,MAAM,CAACC,MAAP,CAAeC,4BAAgBC,UAA/B,EAA4CC,QAA5C,CAAsDC,KAAtD,IACJ,MADI,GAEJV,KAFH;AAGA;;;WAED,oCAAwD;AAAA,UAA5BW,IAA4B,SAAjCrC,GAAiC;AAAA,UAAnBmD,cAAmB;AAAA,UAC/CtC,aAD+C,GAC7B,KAAKjC,KADwB,CAC/CiC,aAD+C;AAEvD,aAAOwB,IAAI,KAAKV,SAAT,GACJd,aAAa,CAAEsC,cAAF,CADT,GAEJtC,aAAa,iCAAOsC,cAAP;AAAuBd,QAAAA,IAAI,EAAJA;AAAvB,SAFhB;AAGA;;;WAED,2BAAkB;AAAA,UACTe,kBADS,GACc,KAAKvE,KADnB,CACTuE,kBADS;AAAA,kCAIb,KAAKxE,KAJQ,CAGhBgC,UAHgB;AAAA,UAGIZ,GAHJ,yBAGFqC,IAHE;AAAA,UAGYgB,kBAHZ;;AAMjB,UAAMC,gBAAgB,mCAAQD,kBAAR;AAA4BrD,QAAAA,GAAG,EAAHA;AAA5B,QAAtB;;AAEA,aACC,4BAAC,kCAAD;AACC,QAAA,SAAS,EAAGoD,kBADb;AAEC,QAAA,GAAG,EAAGE,gBAAgB,CAACtD,GAFxB;AAGC,QAAA,GAAG,EAAGsD,gBAAgB,CAACC,GAHxB;AAIC,QAAA,KAAK,EAAGD,gBAAgB,CAACrD,KAJ1B;AAKC,QAAA,UAAU,EAAGqD,gBAAgB,CAACE,UAL/B;AAMC,QAAA,OAAO,EAAG,KAAKC,YANhB;AAOC,QAAA,aAAa,EAAG,KAAK5D,mBAPtB;AAQC,QAAA,eAAe,EAAG,KARnB;AASC,QAAA,SAAS,MATV;AAUC,QAAA,OAAO,EAAG,KAAKE,mBAVhB;AAWC,QAAA,QAAQ,EAAG;AAXZ,QADD;AAeA;;;WAED,8BAAqB;AAAA;;AAAA,UAEL2D,GAFK,GAGhB,KAAK9E,KAHW,CAEnBgC,UAFmB,CAEL8C,GAFK;;AAKpB,UAAMC,SAAS,GAAG,SAAZA,SAAY,CAAEC,MAAF,EAAc;AAC/B,QAAA,MAAI,CAAChF,KAAL,CAAWiC,aAAX,CAA0B;AAAE6C,UAAAA,GAAG,EAAEE;AAAP,SAA1B;AACA,OAFD;;AAIA,aACC,4BAAC,kCAAD;AACC,QAAA,YAAY,EAAGF,GADhB;AAEC,QAAA,QAAQ,EAAGC,SAFZ;AAGC,QAAA,WAAW,EAAG,cAAI,cAAJ,CAHf;AAIC,QAAA,KAAK,EAAG,cAAI,UAAJ,CAJT;AAKC,QAAA,IAAI,EAAGE,gBALR;AAMC,QAAA,UAAU,EACT,qDACG,cACD,oFADC,CADH,EAIC,4BAAC,6BAAD;AACC,UAAA,IAAI,EACH,wDAFF;AAIC,UAAA,KAAK,EAAG,cAAI,mBAAJ;AAJT,UAJD;AAPF,QADD;AAsBA;;;WAED,2BAAmBC,QAAnB,EAA8B;AAC7B,WAAKtE,aAAL,CAAoBsE,QAApB;AACA;;;WAED,kBAAS;AAAA;;AAAA,UACAhF,iBADA,GACsB,KAAKD,KAD3B,CACAC,iBADA;AAAA,yBAUJ,KAAKF,KAVD;AAAA,UAGPgC,UAHO,gBAGPA,UAHO;AAAA,UAIPmD,UAJO,gBAIPA,UAJO;AAAA,UAKPtF,KALO,gBAKPA,KALO;AAAA,UAMPuF,QANO,gBAMPA,QANO;AAAA,UAOPtB,gBAPO,gBAOPA,gBAPO;AAAA,UAQPuB,eARO,gBAQPA,eARO;AAAA,UASPC,oBATO,gBASPA,oBATO;AAAA,UAWA9B,KAXA,GAW6CxB,UAX7C,CAWAwB,KAXA;AAAA,UAWOpC,GAXP,GAW6CY,UAX7C,CAWOZ,GAXP;AAAA,UAWY0D,GAXZ,GAW6C9C,UAX7C,CAWY8C,GAXZ;AAAA,UAWiB5C,EAXjB,GAW6CF,UAX7C,CAWiBE,EAXjB;AAAA,UAWqBpC,QAXrB,GAW6CkC,UAX7C,CAWqBlC,QAXrB;AAAA,UAW+ByF,SAX/B,GAW6CvD,UAX7C,CAW+BuD,SAX/B;AAaR,UAAMC,gBAAgB,GAAG,kBAAM,KAAK7D,WAAX,EAAwB,CAChD,OADgD,EAEhDmC,gBAFgD,CAAxB,CAAzB;AAKA,UAAM2B,eAAe,GAAGJ,eAAe,KAAKrD,UAAU,CAACE,EAAvD;;AAEA,UAAMwD,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAEC,IAAF;AAAA,eAC5B,4BAAC,0BAAD,QACC,4BAAC,wBAAD,QACC,4BAAC,yBAAD;AACC,UAAA,KAAK,EAAG,cAAI,YAAJ,CADT;AAEC,UAAA,IAAI,EAAGC,cAFR;AAGC,UAAA,OAAO,EAAGD;AAHX,UADD,CADD,EAQC,4BAAC,kCAAD;AACC,UAAA,KAAK,EAAGnC,KADT;AAEC,UAAA,QAAQ,EAAG,MAAI,CAACzC;AAFjB,UARD,CAD4B;AAAA,OAA7B;;AAgBA,UAAM8E,oBAAoB,GAAG,SAAvBA,oBAAuB;AAAA,eAC5B,4BAAC,8BAAD,QACC,4BAAC,qBAAD;AAAW,UAAA,KAAK,EAAG,cAAI,gBAAJ;AAAnB,UADD,EAEC,4BAAC,qBAAD;AAAW,UAAA,KAAK,EAAGzB,gBAAO0B;AAA1B,WACC,4BAAC,wBAAD;AAAa,UAAA,QAAQ,EAAGV,QAAxB;AAAmC,UAAA,GAAG,EAAGhE;AAAzC,UADD,CAFD,EAKC,4BAAC,qBAAD,QACGvB,KAAK,IAAI2F,gBAAT,IACD,4BAAC,8BAAD;AACC,UAAA,IAAI,EAAGO,aADR;AAEC,UAAA,KAAK,EAAG,cAAI,MAAJ,CAFT;AAGC,UAAA,KAAK,EAAGjG,QAAQ,IAAIgE,gBAHrB;AAIC,UAAA,aAAa,EAAG,MAAI,CAAC5C,iBAJtB;AAKC,UAAA,OAAO,EAAG,MAAI,CAACS;AALhB,UAFF,EAUG,MAAI,CAACqE,kBAAL,EAVH,CALD,EAiBC,4BAAC,qBAAD;AAAW,UAAA,KAAK,EAAG,cAAI,eAAJ;AAAnB,WACG,MAAI,CAACC,eAAL,CAAsB,IAAtB,CADH,CAjBD,CAD4B;AAAA,OAA7B;;AAwBA,UAAK,CAAE7E,GAAP,EAAa;AACZ,eACC,4BAAC,iBAAD;AAAM,UAAA,KAAK,EAAGgD,gBAAO8B;AAArB,WACC,4BAAC,6BAAD;AACC,UAAA,YAAY,EAAG,CAAEC,6BAAF,CADhB;AAEC,UAAA,QAAQ,EAAG,KAAK5F,yBAFjB;AAGC,UAAA,IAAI,EAAG,KAAK6F,kBAAL,EAHR;AAIC,UAAA,OAAO,EAAG,KAAKpG,KAAL,CAAWiE,OAJtB;AAKC,UAAA,mBAAmB,EAClBkB,UAAU,IAAI,CAAE/D,GAAhB,IAAuBkE;AANzB,UADD,CADD;AAaA;;AAED,UAAMe,WAAW,GAAG;AACnBC,QAAAA,IAAI,EAAE,YADa;AAEnBC,QAAAA,MAAM,EAAE,QAFW;AAGnBC,QAAAA,KAAK,EAAE,UAHY;AAInBC,QAAAA,IAAI,EAAE,QAJa;AAKnBC,QAAAA,IAAI,EAAE;AALa,OAApB;;AAQA,UAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAAEC,gBAAF,EAAoBC,eAApB;AAAA,eACzB,4BAAC,iBAAD;AAAO,UAAA,KAAK,EAAG,cAAI,UAAJ,CAAf;AAAkC,UAAA,IAAI,EAAGpB;AAAzC,WACC,4BAAC,qCAAD;AACC,UAAA,UAAU,EAAG,CAAEN,UADhB;AAEC,UAAA,OAAO,EAAG,MAAI,CAACtE,cAFhB;AAGC,UAAA,WAAW,EAAG+F,gBAHf;AAIC,UAAA,QAAQ,EAAG,CAAEzB;AAJd,WAMC,4BAAC,iBAAD;AAAM,UAAA,KAAK,EAAGf,gBAAO8B;AAArB,WACGf,UAAU,IAAIU,oBAAoB,EADrC,EAEGV,UAAU,IAAI0B,eAAe,EAFhC,EAGG,CAAE,MAAI,CAAC5G,KAAL,CAAWC,iBAAb,IACDwF,oBAAoB,CAAEkB,gBAAF,CAJtB,EAKC,4BAAC,gCAAD;AACC,UAAA,QAAQ,EAAGxF,GADZ;AAEC,UAAA,OAAO,EAAGc,EAFX;AAGC,UAAA,qBAAqB,EAAG,MAAI,CAAC1B,mBAH9B;AAIC,UAAA,8BAA8B,EAC7B,MAAI,CAACL,4BALP;AAOC,UAAA,8BAA8B,EAC7B,MAAI,CAACE,4BARP;AAUC,UAAA,uBAAuB,EACtB,MAAI,CAACC,qBAXP;AAaC,UAAA,aAAa,EAAG,8BAIT;AAAA,gBAHN+B,kBAGM,SAHNA,kBAGM;AAAA,gBAFNyE,cAEM,SAFNA,cAEM;AAAA,gBADNC,YACM,SADNA,YACM;AACN,mBACC,4BAAC,iBAAD;AACC,cAAA,KAAK,EAAGvD,KAAK,IAAI6C,WAAW,CAAE7C,KAAF,CAD7B;AAEC,cAAA,GAAG,EAAGsB,GAFP;AAGC,cAAA,UAAU,EACTK,UAAU,IAAI,CAAEjF,iBAJlB;AAMC,cAAA,cAAc,EAAG4G,cANlB;AAOC,cAAA,kBAAkB,EACjBzE,kBARF;AAUC,cAAA,yBAAyB,EACxB,MAAI,CAAC9B,yBAXP;AAaC,cAAA,gBAAgB,EAAGqG,gBAbpB;AAcC,cAAA,YAAY,EAAGG,YAdhB;AAeC,cAAA,GAAG,EAAG3F,GAfP;AAgBC,cAAA,UAAU,EAAGgD,gBAAQmB,SAAR,CAhBd;AAiBC,cAAA,KAAK,EAAG,MAAI,CAACyB,QAAL;AAjBT,cADD;AAqBA;AAvCF,UALD,CAND,CADD,EAuDC,4BAAC,yBAAD;AACC,UAAA,QAAQ,EAAG,MAAI,CAAChH,KAAL,CAAWoF,QADvB;AAEC,UAAA,UAAU,EAAG,MAAI,CAACnF,KAAL,CAAWC,iBAFzB;AAGC,UAAA,UAAU,MAHX;AAIC,UAAA,yBAAyB,EAAG,MAAI,CAACc,yBAJlC;AAKC,UAAA,OAAO,EAAG,MAAI,CAACF,cALhB;AAMC,UAAA,MAAM,EAAG,MAAI,CAACd,KAAL,CAAWiH,MANrB,CAM8B;AAN9B;AAOC,UAAA,iBAAiB,EAAG,MAAI,CAACjH,KAAL,CAAWkH;AAPhC,UAvDD,CADyB;AAAA,OAA1B;;AAoEA,aACC,4BAAC,wBAAD;AACC,QAAA,YAAY,EAAG,CAAEf,6BAAF,CADhB;AAEC,QAAA,gBAAgB,EAAG,IAFpB;AAGC,QAAA,QAAQ,EAAG,KAAK5F,yBAHjB;AAIC,QAAA,MAAM,EAAG,uBAAiC;AAAA,cAA7BoF,IAA6B,SAA7BA,IAA6B;AAAA,cAAvBkB,eAAuB,SAAvBA,eAAuB;AACzC,iBAAOF,iBAAiB,CAAEhB,IAAF,EAAQkB,eAAR,CAAxB;AACA;AANF,QADD;AAUA;;;WAlaD,kCAAiC7G,KAAjC,EAAwCC,KAAxC,EAAgD;AAC/C;AACA;AACA,aAAO;AACNC,QAAAA,iBAAiB,EAAEF,KAAK,CAACmF,UAAN,IAAoBlF,KAAK,CAACC;AADvC,OAAP;AAGA;;;EAnH6BiH,kB;;;;eAkhBhB,sBAAS,CACvB,sBAAY,UAAEC,MAAF,EAAUpH,KAAV,EAAqB;AAAA,gBACXoH,MAAM,CAAEC,eAAF,CADK;AAAA,MACxBC,QADwB,WACxBA,QADwB;;AAAA,iBAEcF,MAAM,CACnDG,kBADmD,CAFpB;AAAA,MAExBC,WAFwB,YAExBA,WAFwB;AAAA,MAEXlC,oBAFW,YAEXA,oBAFW;;AAAA,iBAKG8B,MAAM,CAAE,aAAF,CALT;AAAA,MAKxBK,sBALwB,YAKxBA,sBALwB;;AAAA,0BAU5BzH,KAV4B,CAO/BgC,UAP+B;AAAA,MAOjBE,EAPiB,qBAOjBA,EAPiB;AAAA,MAObd,GAPa,qBAObA,GAPa;AAAA,MAQ/B+D,UAR+B,GAU5BnF,KAV4B,CAQ/BmF,UAR+B;AAAA,MAS/BC,QAT+B,GAU5BpF,KAV4B,CAS/BoF,QAT+B;;AAAA,qBAWSoC,WAAW,EAXpB;AAAA,MAWxB5F,UAXwB,gBAWxBA,UAXwB;AAAA,MAWZkC,gBAXY,gBAWZA,gBAXY;;AAYhC,MAAM4D,YAAY,GAAGxF,EAAE,IAAI,sBAAad,GAAb,MAAuB,OAAlD;AACA,MAAMiE,eAAe,GAAGoC,sBAAsB,CAAE,gBAAF,CAA9C;AAEA,MAAME,cAAc,GACjBxC,UAAU,IAAIuC,YAAhB,IACA;AACA;AACE,GAAEvC,UAAF,IACDuC,YADC,IAEDtG,GAFC,IAGD,CAAE,sBAAaA,GAAb,EAAkB,GAAlB,CAPJ;AASA,SAAO;AACNvB,IAAAA,KAAK,EAAE8H,cAAc,GAAGL,QAAQ,CAAEpF,EAAF,CAAX,GAAoB,IADnC;AAENN,IAAAA,UAAU,EAAVA,UAFM;AAGNkC,IAAAA,gBAAgB,EAAhBA,gBAHM;AAINuB,IAAAA,eAAe,EAAfA,eAJM;AAKNC,IAAAA,oBAAoB,EAAEA,oBAAoB,CACzCF,QADyC,EAEzC,eAFyC;AALpC,GAAP;AAUA,CAlCD,CADuB,EAoCvBwC,iCApCuB,CAAT,EAqCV7H,SArCU,C","sourcesContent":["/**\n * External dependencies\n */\nimport { View, TouchableWithoutFeedback } from 'react-native';\nimport { isEmpty, get, find, map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n} from '@wordpress/react-native-bridge';\nimport {\n\tCycleSelectControl,\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheetTextControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockStyles,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\texpand,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport { LINK_DESTINATION_CUSTOM } from './constants';\n\nconst getUrlForSlug = ( image, { sizeSlug } ) => {\n\treturn get( image, [ 'media_details', 'sizes', sizeSlug, 'source_url' ] );\n};\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t};\n\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption = this.onSelectMediaUploadOption.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.accessibilityLabelCreator = this.accessibilityLabelCreator.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\n\t\tthis.linkSettingsOptions = {\n\t\t\turl: {\n\t\t\t\tlabel: __( 'Image Link URL' ),\n\t\t\t\tplaceholder: __( 'Add URL' ),\n\t\t\t\tautoFocus: false,\n\t\t\t\tautoFill: true,\n\t\t\t},\n\t\t\topenInNewTab: {\n\t\t\t\tlabel: __( 'Open in new tab' ),\n\t\t\t},\n\t\t\tlinkRel: {\n\t\t\t\tlabel: __( 'Link Rel' ),\n\t\t\t\tplaceholder: __( 'None' ),\n\t\t\t},\n\t\t};\n\n\t\tthis.sizeOptions = map( this.props.imageSizes, ( { name, slug } ) => ( {\n\t\t\tvalue: slug,\n\t\t\tname,\n\t\t} ) );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.isUploadInProgress\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tif ( ! previousProps.image && this.props.image ) {\n\t\t\tconst { image, attributes } = this.props;\n\t\t\tconst url = getUrlForSlug( image, attributes ) || image.source_url;\n\t\t\tthis.props.setAttributes( { url } );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\treturn isEmpty( caption )\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = Object.values(\n\t\t\tWIDE_ALIGNMENTS.alignments\n\t\t).includes( nextAlign )\n\t\t\t? { width: undefined, height: undefined }\n\t\t\t: {};\n\t\tthis.props.setAttributes( {\n\t\t\t...extraUpdatedAttributes,\n\t\t\talign: nextAlign,\n\t\t} );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image } = this.props;\n\n\t\tconst url = getUrlForSlug( image, { sizeSlug } );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\timageDefaultSize,\n\t\t} = this.props;\n\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\treturn href === undefined\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( { ...restAttributes, href } );\n\t}\n\n\tgetLinkSettings() {\n\t\tconst { isLinkSheetVisible } = this.state;\n\t\tconst {\n\t\t\tattributes: { href: url, ...unMappedAttributes },\n\t\t} = this.props;\n\n\t\tconst mappedAttributes = { ...unMappedAttributes, url };\n\n\t\treturn (\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ mappedAttributes.url }\n\t\t\t\trel={ mappedAttributes.rel }\n\t\t\t\tlabel={ mappedAttributes.label }\n\t\t\t\tlinkTarget={ mappedAttributes.linkTarget }\n\t\t\t\tonClose={ this.dismissSheet }\n\t\t\t\tsetAttributes={ this.setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ this.linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if the image is purely decorative. '\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\n\t\tconst sizeOptionsValid = find( this.sizeOptions, [\n\t\t\t'value',\n\t\t\timageDefaultSize,\n\t\t] );\n\n\t\tconst isFeaturedImage = featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<CycleSelectControl\n\t\t\t\t\t\t\ticon={ expand }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug || imageDefaultSize }\n\t\t\t\t\t\t\tonChangeValue={ this.onSizeChangeValue }\n\t\t\t\t\t\t\toptions={ this.sizeOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t\t\t{ this.getLinkSettings( true ) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && ! url && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ __( 'Featured' ) } show={ isFeaturedImage }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tonLongPress={ openMediaOptions }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\talign={ align && alignToFlex[ align ] }\n\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\tisSelected && ! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\topenMediaOptions={ openMediaOptions }\n\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\tshapeStyle={ styles[ className ] }\n\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // always assign onBlur as props\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } = select(\n\t\t\tblockEditorStore\n\t\t);\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\n\t\treturn {\n\t\t\timage: shouldGetMedia ? getMedia( id ) : null,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"]}