{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/index.js"],"names":["TemplatePartEdit","attributes","setAttributes","clientId","slug","theme","tagName","layout","templatePartId","hasAlreadyRendered","RecursionProvider","select","coreStore","getEditedEntityRecord","hasFinishedResolution","blockEditorStore","getBlocks","getEntityArgs","entityRecord","hasResolvedEntity","innerBlocks","isResolved","isMissing","area","blockProps","isPlaceholder","isEntityAvailable","TagName","length","isOpen","onToggle","onClose"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport {\n\tBlockControls,\n\tuseBlockProps,\n\t__experimentalUseNoRecursiveRenders as useNoRecursiveRenders,\n\tWarning,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport {\n\tDropdown,\n\tToolbarGroup,\n\tToolbarButton,\n\tSpinner,\n} from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport TemplatePartInnerBlocks from './inner-blocks';\nimport TemplatePartPlaceholder from './placeholder';\nimport TemplatePartSelection from './selection';\nimport { TemplatePartAdvancedControls } from './advanced-controls';\nimport { getTagBasedOnArea } from './get-tag-based-on-area';\n\nexport default function TemplatePartEdit( {\n\tattributes,\n\tsetAttributes,\n\tclientId,\n} ) {\n\tconst { slug, theme, tagName, layout = {} } = attributes;\n\tconst templatePartId = theme && slug ? theme + '//' + slug : null;\n\n\tconst [ hasAlreadyRendered, RecursionProvider ] = useNoRecursiveRenders(\n\t\ttemplatePartId\n\t);\n\n\t// Set the postId block attribute if it did not exist,\n\t// but wait until the inner blocks have loaded to allow\n\t// new edits to trigger this.\n\tconst { isResolved, innerBlocks, isMissing, area } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEditedEntityRecord, hasFinishedResolution } = select(\n\t\t\t\tcoreStore\n\t\t\t);\n\t\t\tconst { getBlocks } = select( blockEditorStore );\n\n\t\t\tconst getEntityArgs = [\n\t\t\t\t'postType',\n\t\t\t\t'wp_template_part',\n\t\t\t\ttemplatePartId,\n\t\t\t];\n\t\t\tconst entityRecord = templatePartId\n\t\t\t\t? getEditedEntityRecord( ...getEntityArgs )\n\t\t\t\t: null;\n\t\t\tconst hasResolvedEntity = templatePartId\n\t\t\t\t? hasFinishedResolution(\n\t\t\t\t\t\t'getEditedEntityRecord',\n\t\t\t\t\t\tgetEntityArgs\n\t\t\t\t  )\n\t\t\t\t: false;\n\n\t\t\treturn {\n\t\t\t\tinnerBlocks: getBlocks( clientId ),\n\t\t\t\tisResolved: hasResolvedEntity,\n\t\t\t\tisMissing: hasResolvedEntity && ! entityRecord,\n\t\t\t\tarea: entityRecord?.area,\n\t\t\t};\n\t\t},\n\t\t[ templatePartId, clientId ]\n\t);\n\n\tconst blockProps = useBlockProps();\n\tconst isPlaceholder = ! slug;\n\tconst isEntityAvailable = ! isPlaceholder && ! isMissing && isResolved;\n\tconst TagName = tagName || getTagBasedOnArea( area );\n\n\t// We don't want to render a missing state if we have any inner blocks.\n\t// A new template part is automatically created if we have any inner blocks but no entity.\n\tif (\n\t\tinnerBlocks.length === 0 &&\n\t\t( ( slug && ! theme ) || ( slug && isMissing ) )\n\t) {\n\t\treturn (\n\t\t\t<TagName { ...blockProps }>\n\t\t\t\t<Warning>\n\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t/* translators: %s: Template part slug */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Template part has been deleted or is unavailable: %s'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tslug\n\t\t\t\t\t) }\n\t\t\t\t</Warning>\n\t\t\t</TagName>\n\t\t);\n\t}\n\n\tif ( isEntityAvailable && hasAlreadyRendered ) {\n\t\treturn (\n\t\t\t<TagName { ...blockProps }>\n\t\t\t\t<Warning>\n\t\t\t\t\t{ __( 'Block cannot be rendered inside itself.' ) }\n\t\t\t\t</Warning>\n\t\t\t</TagName>\n\t\t);\n\t}\n\n\treturn (\n\t\t<RecursionProvider>\n\t\t\t<TemplatePartAdvancedControls\n\t\t\t\ttagName={ tagName }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\tisEntityAvailable={ isEntityAvailable }\n\t\t\t\ttemplatePartId={ templatePartId }\n\t\t\t/>\n\t\t\t{ isPlaceholder && (\n\t\t\t\t<TagName { ...blockProps }>\n\t\t\t\t\t<TemplatePartPlaceholder\n\t\t\t\t\t\tarea={ attributes.area }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\tinnerBlocks={ innerBlocks }\n\t\t\t\t\t/>\n\t\t\t\t</TagName>\n\t\t\t) }\n\t\t\t{ isEntityAvailable && (\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<ToolbarGroup className=\"wp-block-template-part__block-control-group\">\n\t\t\t\t\t\t<Dropdown\n\t\t\t\t\t\t\tclassName=\"wp-block-template-part__preview-dropdown-button\"\n\t\t\t\t\t\t\tcontentClassName=\"wp-block-template-part__preview-dropdown-content\"\n\t\t\t\t\t\t\tposition=\"bottom right left\"\n\t\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\t\t\t\t// Disable when open to prevent odd FireFox bug causing reopening.\n\t\t\t\t\t\t\t\t\t// As noted in https://github.com/WordPress/gutenberg/pull/24990#issuecomment-689094119 .\n\t\t\t\t\t\t\t\t\tdisabled={ isOpen }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Replace' ) }\n\t\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t\t\t\t\t<TemplatePartSelection\n\t\t\t\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ToolbarGroup>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ isEntityAvailable && (\n\t\t\t\t<TemplatePartInnerBlocks\n\t\t\t\t\ttagName={ TagName }\n\t\t\t\t\tblockProps={ blockProps }\n\t\t\t\t\tpostId={ templatePartId }\n\t\t\t\t\thasInnerBlocks={ innerBlocks.length > 0 }\n\t\t\t\t\tlayout={ layout }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ ! isPlaceholder && ! isResolved && (\n\t\t\t\t<TagName { ...blockProps }>\n\t\t\t\t\t<Spinner />\n\t\t\t\t</TagName>\n\t\t\t) }\n\t\t</RecursionProvider>\n\t);\n}\n"]}